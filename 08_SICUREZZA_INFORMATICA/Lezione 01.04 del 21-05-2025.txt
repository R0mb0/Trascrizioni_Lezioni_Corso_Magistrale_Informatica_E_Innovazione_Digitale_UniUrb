in questa lezione vi volevo raccontare in un paio d'ore come funziona diciamo come funzionano tutte le questioni relative alla sicurezza nell'ambito delle blockchain visto che sono un argomento abbastanza caldo ancora e visto che abbiamo studiato molte molti temi che trovo in implementazione nel modo in cui le blockchains sono realizzate farvi vedere dal punto di vista pratico come questo accade può essere interessante per diciamo non generalizzare chiaramente affronterò il discorso dal punto di vista di una blockchain molto specifica che è quella di bitcoin poi magari mettermi in evidenza quelle che sono alcune differenze rispetto ad altre blockchain e quindi dato che parliamo di bitcoin conviene parlare un po' di valuta digitale di digital currency e di spiegare un po' quelle che sono le motivazioni dietro l'introduzione della valuta digitale distribuita implementata attraverso l'idea del bitcoin da lì capiremo anche alcune cose relative al perché le blockchains sono realizzate in un certo modo esistono tanti tante diverse combinazioni di valute digitali ok che comunque sono tutte accumulate dal fatto tutto accumulato dal fatto di rappresentare valuta reale ok o virtuale perché se ad esempio vogliamo parlare di quello che sarà l'euro digitale che dovrebbe a breve diventare una realtà di fatto in quel caso si parlerà di una valuta digitale virtuale e non di una valuta digitale reale ok però poi ci sono tanti modi di declinarle le valute digitali possono essere convertibili o non convertibili possono essere inizialmente sono sempre state centralizzate ma adesso possono essere anche distribuite bitcoin in particolare è una tipologia di valuta digitale virtuale basata su operazioni criptografiche che vedremo convertibile bitcoin possono essere convertiti in qualunque altro tipo di valuta reale e completamente distribuita ok l'elemento di novità è questo il fatto di essere completamente distribuiti perché di valuta digitale si parla da più di vent'anni ma specialmente nei primi dieci anni degli anni 2000 per valuta digitale si intendeva intendeva intendevano soluzioni che si appoggia sono comunque piattaforme centralizzate quindi erano le banche stesse a gestire la valuta digitale chiaramente mettere in campo una soluzione distribuita solleva tutta una serie di problematiche che noi cercheremo di affrontare di capire perché la blockchain bitcoin risolve anche se non completamente la maggior parte di queste problematiche che vediamo elencate qui partiamo dall'idea appunto di base ovvero realizzare una sorta di trasferimento di valuta digitale tra due agenti che operano online ok questa è l'idea abbiamo Alice abbiamo Bob Alice vuole trasferire una un certo quantitativo di valuta digitale a Bob che quindi sarà rappresentata in qualche modo da una bit string ok il primo problema da affrontare che non si ha con la valuta reale ovviamente è quello del double spending cosa impedisce ad Alice di spendere la stessa moneta digitale nei confronti di una transazione con Bob e nei confronti di una promozione con Katy ok l'altra l'altro problema non banale da affrontare è la falsificazione nel momento in cui la valuta digitale non è altro che una bit string chi cosa impedisce a Yves di falsificare una moneta digitale e di spenderla nei confronti di un'altra gente onesto questi sono i due problemi fondamentali che fin dall'inizio hanno in qualche modo condizionato la creazione, lo sviluppo di soluzioni per la digital currency ora per quanto riguarda il discorso del double spending l'uso delle firme digitali rappresenta una prima soluzione ovvia a questo tipo di problema ok qui qual è l'idea? L'idea è che Alice Alice firma la transazione che rappresenta un certo trasferimento ok di valuta digitale che è in suo possesso questo è un primo passo verso risolvere il problema del double spending perché se Alice firma una transazione del trasferimento di una certa valuta a Bob non lo può fare anche nei confronti di qualcun altro se si adottano certe accortezze e l'altra cosa è che questo tipo di soluzione va anche incontro al problema della falsificazione perché quantomeno con un'operazione di questo genere siamo certi che Alice e non chiunque a diciamo annunciare l'intenzione di effettuare una certa una certa transazione ok l'ora in avanti la scriverò semplicemente così no? M è un messaggio firmato da Alice che dichiara un qualche cosa ok ad esempio il fatto che Alice vuole pagare con una moneta digitale Bob ok not alone not alone ok but it helps i vantaggi dell'uso delle firme digitale li conosciamo già chiunque può verificare la firma sconoscendo la chiave pubblica di Alice nessuno può creare la firma può falsificare una firma se Alice usa uno schema di firma digitale sicuro inoltre Alice non può ripudiare in una transazione firmata da lei proprio per il fatto che solo lei può creare la firma digitale e svantaggi uno svantaggio ovvio è l'anonimato chiunque proprio per il motivo che dicevamo prima siccome chiunque può verificare la firma allora chiunque può verificare che Alice vuole pagare Bob e questo chiaramente non va bene per la privacy e l'anonimato ma questo lo mettiamo un attimo da parte e lo affronteremo poi veniamo al problema del double spending la firma da sola è sufficiente per evitare il double spending fatta in questo modo ovviamente la risposta è no perché se la transazione è io Alice do a Bob una moneta digitale e poi Alice rifirma un'altra io Alice do a Katie una moneta digitale cosa impedisce l'Alice di dare la stessa moneta digitale a entrambi ok una soluzione può essere questa una prima soluzione che uno può pensare può essere questa ok usare un identificativo per rappresentare in maniera univoca la moneta astraiamo la moneta particolare che Alice vuole dare Bob se questa transazione viene pubblicata ed è resa disponibile a tutti se Alice tenta di fare double spending quindi spendere la stessa moneta in un'altra transazione un'altra persona chiaramente questo tentativo viene svelato viene scoperto ok questo è il tipo di soluzione che di solito è sempre stato utilizzato nelle soluzioni centralizzate delle valute digitali ripeto soluzioni che risalgono già alla prima metà degli anni alla prima metà degli anni 2000 in quel caso l'idea qual era? l'idea era che un TTP cioè una banca fatto a fronte di garanzia la cosa più semplice era Alice ha un conto in banca ok la banca che cosa fa? converte parte del deposito che Alice ha in banca in valuta digitale che di fatto la banca Conia il mind della moneta viene fatto dalla banca che dà un numero di serie alla moneta e dice io banca X riconosco questa moneta digitale che io ho creato e il cui valore è un dollaro, un euro, quello che volete e questa la do ad Alice si l'onore riche ok no you decide you have your money in the bank and you have decided to use that money or physically withdraw withdraw money from the ATM machine or to convert it into virtual currency to ask the bank for a digital coin and use it for a virtual transaction so it worked years ago and whenever Bob receives the payment he gives the coin to the bank the bank validates the coin verifies that actually that was a coin possessed by Alice not double spent and then pays the actual money to Bob ok questo è il modo in cui funzionavano le colne nei primi anni nei primi anni 2000 ed è una soluzione senza particolari problemi ok chiaramente molto più sfidante è una soluzione completamente distribuita senza banca perché viene a mancare il TTP che ad esempio genera la moneta in numeri di serie stabilisce chi è il proprietario di ogni moneta e così via anche perché nelle transazioni di una volta queste monete virtuali dove a ogni transazione devono sempre passare per la banca per il check ok io non potevo vendere una moneta Alice non poteva vendere la moneta Bob il quale a sua volta direttamente la vendeva a Katie per ognuno di questi passaggi ci doveva essere la verifica da parte del TTP della banca anche ora nelle soluzioni distribuite la il TTP la banca viene di fatto sostituita da un archivio chiamato appunto blockchain distribuito archivio che di fatto contiene tutte le informazioni come vedremo relative al trasferimento di valuta digitale ok quindi tutti i trasferimenti di valuta digitale vengono registrati in questo archivio l'archivio distribuito perché ne esistono tante copie in rete che vengono aggiornate in tempo più o meno reale e quindi sono disponibili a chiunque quindi in un contesto di questo genere l'idea qual è l'idea è un po questa Alice vuole pagare Bob firma la transazione che dice che Alice trasferisce una moneta che ha un certo numero di certo identità a Bob ok e questa transazione viene condivisa con la comunità la comunità Bob in particolare verifica sulla blockchain che questa transazione sia valida quindi ad esempio che non ci sia un caso di double spending ok e quindi verifica sulla blockchain che quella moneta effettivamente sia posseduta da Alice non sia già stata spesa nei confronti di qualcun altro se verificando facendo tutte le verifiche del caso non ci sono problemi ecco che allora la transazione viene registrata sulla sulla blockchain da Bob o di Alice non ha importanza da chi o da qualcun altro come vedremo che ha interesse a farlo per loro e in modo tale che tutti quanti poi si ritrovano la loro versione la loro coppia della blockchain aggiornata con questo trasferimento e quindi e quindi in livello di principio questa è una soluzione che sicuramente ci permette di evitare il problema del double spending ok in che modo verificare il double spending significa fondamentalmente garantire che tutti quelli che utilizzano la blockchain sono d'accordo sul fatto che questa transazione sia corretta ok è un problema del consenso in teoria degli algoritmi di fatto ok poi vedremo come come risolverlo l'idea intuitiva qual è? come facciamo a mettere tutti quanti quindi la comunità d'accordo sul fatto che questa transazione da Alice a Bob vada bene è corretta non c'è double spending o altri altri problemi la soluzione consiste nel avere il consenso da parte chiamiamola di una maggioranza di una majority della comunità ok come si calcola questa maggioranza lo dobbiamo ancora capire però un'idea abbastanza accettabile il fatto che se la maggioranza degli utenti della comunità è d'accordo sul fatto che quella transazione vada bene allora la possiamo registrare e quindi possiamo aggiornare la blockchain la blockchain ok ci sono problemi cosa vuol dire la maggioranza? la maggioranza numerica come nei sistemi di voto è vulnerabile a una soluzione di questo tipo specialmente per sistemi non troppo grandi e tutte le cryptocurrencies all'inizio si basano sui sistemi che non sono grandi come si fa a risolvere ad esempio il problema delle fake identities? un attacco tipico che prende il nome di cible attack è quando un avversario crea genera molte molte utenti fake molte identità e questi votano ok quindi se la maggioranza dei utenti sono controllati dall'avversario allora è facile che l'avversario raggiunga una specie di maggioranza e prenda delle decisioni che magari non sono quelle corrette come ad esempio registrare una blockchain una transazione che in realtà rappresenta double spending o qualcosa di questo genere e diciamo l'idea originale che sta nel nella dietro la blockchain in particolare quella la prima blockchain che è quella proposta appunto nell'ambito del bitcoin consiste proprio nel modo in cui questa maggioranza viene determinata ok nell'idea originale di bitcoin la maggioranza viene determinata in funzione di quella che è il è la potenza di calcolo di tutti gli utenti che fanno parte della comunità ok questo è un po' è l'idea e l'idea qual è l'idea è che non ci si basa come in altri sistemi sul voto tutti quelli della tutti i membri della comunità votano e poi si va a vedere chi dove sta la maggioranza l'idea è che gli utenti che vogliono farsi vogliono far approvare dalla comunità uno più transazioni devono dimostrare di aver compiuto un certo sforzo computazionale chi riesce a dimostrare di aver compiuto questo sforzo ha il diritto di validare una transazione e quindi aggiornare la blockchain non è che io voglio pubblicare una transazione sulla blockchain che dice dice paga x a bob e chiede se siete tutti d'accordo e gli utenti della comunità sono la mano e poi si fa la conta l'idea qual è l'idea è che alice dice io voglio far approvare questa transazione ok la comunità i membri della comunità che cosa fanno? i membri della comunità eseguono quella che il vero si chiama proof of work quindi eseguono dei calcoli andremo a vedere come sono fatti questi questi calcoli dal punto di vista proprio litografico quindi eseguono uno sforzo computazionale che consiste nel risolvere un puzzle una specie di problema matematico e chi ci riesce chiaramente da un punto di vista probabilistico chi mette in campo più risorse di calcolo ha più probabilità di riuscire a vincere questo puzzle quindi chi ci riesce ha la possibilità di decidere che quella particolare transazione se valida verrà pubblicata sulla blockchain ok quindi il problema si sposta da un voto di maggioranza basato sulle persone sui agenti ad un voto invece basato sulla potenza di calcolo ok perché questo shift no? dalle teste delle persone alla potenza di calcolo perché mentre le teste delle persone si possono controllare ad esempio con un simile attack la potenza di calcolo invece no ci vorrebbe un vedremo un avversario che ha una quantità di risorse di calcolo decisamente superiori a quelle di tutto il resto della comunità per avere una qualche probabilità non negligible di riuscire a vincere come quando gli pare il puzzle della proof of work e quindi pubblicare quello che vuole nella blockchain poi alla volta entreremo nei dettagli la proof of work di bitcoin poi la vedremo più nello specifico ma in cosa consiste nella sua idea di base? consiste nel riuscire a calcolare un digest fatto in un certo modo ok voi immaginate che M sia la transazione che io voglio validare sto stregando per semplificare un po' le cose M è il messaggio io Alice voglio trasferire questo coin a Bob quindi M è il messaggio, la transazione risolvere la proof of work significa trovare un nonce x tale per cui il messaggio M concatenato con il nonce dato in input ad una certa funzione hash restituisce un digest che è fatto in un certo modo ad esempio comincia con n veri questo è esattamente il modo in cui funziona la proof of work di bitcoin ora se la funzione hash è sicura ok quindi è una funzione impredicibile pseudo random io finché non calcolo il digest di un certo input non lo so come sarà fatto l'output ok o in altre parole io so che devo generare un digest fatto in un certo modo non riesco a partire dal digest che so io voglio creare un digest che inizia con 50 zeri siccome le funzioni non sono invertibili io non riesco a trovare a indovinare un input che abbia le caratteristiche tali da generare quel particolare digest l'unica cosa che posso fare è un brute force quindi io prendo M ci attacco un nonce random e vedo cosa salta fuori come digest ha le caratteristiche? sì, ho trovato la proof of work no, provo con un'out quindi le risorse del calcolo che io devo spendere mi servono per fare un brute force attacker su una funzione hash ovvero trovare un certo input che mi dia come risultato un output fatto in un certo modo il primo che lo trova risolve la proof of work alza la mano e dice ho trovato la proof of work e la fa vedere a tutti quanti ok è facile verificarla tutti la possono verificare quindi tutti possono verificare che chi l'ha trovata ha vinto la proof of work chi dice la proof of work pubblica la transazione sulla blockchain come? come? come? sì, dopo vediamo sì, sì, sì ci vogliono incentivi perché altrimenti perché io dovrei spendere le mie risorse di calcolo per risolvere la proof of work che serve ad Alice e a Bob ho bisogno di un incentivo che è un po' è l'idea ok quindi torniamo alla nostra idea di base abbiamo il nostro blockchain abbiamo il nostro archivio distribuito sostituiamo il voto di maggioranza con il gioco con la proof of work lo schema potrebbe diventare questo come Alice vuole trasferire un coin a Bob crea la transazione dice io Alice do questo particolare coin a Bob e pubblico la mia pubblico la mia transazione ok gli utenti della comunità hanno modo di controllare la transazione per vedere se è valida valida significa ad esempio che non è un caso di double spending come fanno a verificarlo? vanno a vedere nella blockchain che quelle pubbliche la conoscono tutti e vanno a vedere se quel particolare coin che Alice vuole spendere è effettivamente il suo non è già stato speso ok quindi se la transazione è corretta allora che cosa succede? succede che i vari utenti della comunità provano, cercano la proof of work per quella transazione ok nel modo che abbiamo visto prima il primo che trova la soluzione alla proof of work alas alla maniera e dice ho trovato la soluzione benissimo tutti d'accordo prende la transazione e la pubblico nella blockchain e poi verrò premiato in qualche modo che andremo a vedere tutti quanti aggiornano la propria copia della blockchain ed ecco che le cose ricominciano procedono poi come prima ok questa è un po' è l'idea non è ancora una soluzione convincente così come l'abbiamo appena descritta perché c'è ancora un problema ovvero come mettersi d'accordo sulle transazioni su cui calcolare la proof of work e quindi andare a aggiornare la blockchain anche questo è un problema del consenso ok ed è un problema che andrà risolto e vediamo come quindi l'idea generale della blockchain di bitcoin o di molte blockchain della maggior parte della blockchain in generale è che il nostro archivio non è altro che una catena di blocchi dove ogni blocco contiene un certo numero di transazioni come quelle che abbiamo detto prima io lì ci voglio dare una moneta a Bob questi blocchi vengono concatenati nella figura che vedete BM rappresenta il blocco più recente B0 è quello che è chiamato blocco Genesi cioè il primo blocco della blockchain ogni blocco è virtualmente concatenato al successivo di questa catena in una maniera tale da garantire la consistenza la correttezza della blockchain in maniera cosiddetta immutabile e questo è un elemento molto importante per quale motivo? perché? perché la blockchain è distribuita la blockchain ce l'hanno tutti ok? io come faccio a sapere di avere la blockchain giusta? come faccio a sapere che la mia blockchain è integra? io magari l'ho copiata da qualcun altro e che ne so che questo qualcun altro non l'ha modificata non ha preso una transazione all'interno della blockchain modificandola devo avere una garanzia di immutabilità cosa vuol dire questo? vuol dire che quando la blockchain in base al protocollo che abbiamo descritto prima basato sul gioco della Proof of Work viene aggiornata dappertutto io devo avere la garanzia che quell'aggiornamento rimane immutabile cioè non lo può cambiare più nessuno la blockchain non è integra la blockchain si iscrive e basta non si può aggiornare perché se si potesse aggiornare essendo un archivio distribuito chiunque potrebbe modificarlo chiunque potrebbe dire no questa è la copia giusta della blockchain un'altra no quest'altra cioè per avere consenso su un dato distribuito bisogna che quel dato sia immutabile ok? come si fa a rendere un dato immutabile? beh giocando sul modo in cui i blocchi della blockchain sono concatenati tra loro prima ho detto che il legame che lega un blocco al suo predecessore è un legame virtuale perché? perché non è che c'è un puntatore che dice questo è il pointer ad un altro blocco ma il legame virtuale viene fatto attraverso l'utilizzo delle funzioni hash ovvero ogni blocco conterrà un riferimento al digest del blocco predecessore ok? così facendo ogni blocco non può essere modificato perché se voi andate a modificare un blocco compromettete il digest di quel blocco e quindi verrà a mancare il link tra un blocco su predecessore o il suo successore secondo il punto del punto di vista ok? quindi qui in particolare BM il blocco BM tra i suoi metadati conterrà il digest del blocco BM-1 che conterrà il digest del blocco BM-2 e così via ok? in questo modo voi chiunque non può andare a modificare un blocco in mezzo alla blockchain perché romperebbe la catena delle dipendenze basate sui sui digest ok? sempre tenuto conto del fatto che si utilizza una funzione asher sicura no? quindi questo risolve il problema dell'immutabilità non risolve il problema del consenso di cui parlavamo prima ok? il problema del consenso di cui parlavamo prima ovvero chi decide l'ordine con cui le transazioni vengono approvate e è aggiornata sulla blockchain questo è un problema che in una situazione reale ci può essere immaginato di avere la blockchain che abbiamo a strato sopra quindi il blocco più recente della blockchain è BM ok? ora ci sono delle nuove transazioni pendenti quindi che ne so in un angolo della comunità si sta facendo proof of work rispetto ad una transazione ok? poi in realtà prima per semplicità vi ho detto che la proof of work si fa rispetto alla transazione non è così la proof of work si fa rispetto a un insieme di transazioni per questione di ottimizzazione ok? quindi si prende un insieme di transazioni pendenti e ci si fa la proof of work sopra ok? quindi immaginiamo che in un angolo della comunità ci sia un utente che trova la proof of work di un gruppo di transazioni pendenti dal lato opposto della comunità dall'altra parte del mondo c'è un altro utente che trova più o meno contemporaneamente la proof of work di un altro gruppo di transazioni pendenti ok? perché non esiste modo per mettere tutti quanti d'accordo su quale o quali devono essere le transazioni da mettere nel blocco e da validare con la proof of work se ci sono tante transazioni in giro che aspettano di essere scritte nella blockchain chiunque può prendere quelle che vuole riempirci un blocco trovare la proof of work del blocco e quindi vincere il puzzle ok? può capitare questo quindi può capitare quella cosa che in generale si chiama fork cioè una situazione in cui più o meno contemporaneamente in due diverse parti della comunità si riesce a risolvere il problema della proof of work su blocchi diversi e quindi in un'area in una zona della comunità il successore di BM diventa BM più 1 in un'altra zona della comunità il successore di BM diventa B' m più 1 può capitare no? più o meno contemporaneamente due nuovi blocchi vengono validati e quindi da una parte la blockchain si aggione in un modo dall'altra la blockchain si aggione in un altro modo quindi se noi vedessimo noi osservatori esterni vedessimo la situazione della blockchain in quel preciso istante non sarebbe più una catena come quella sopra ma diventerebbe no? una biforcazione quindi quella che appunto si chiama fork quindi da BM in su no? si biforca e prende due strade diverse e come si come si risolve questo questo problema finché finché ci sono delle biforcazioni di uguale lunghezza allora finché un utente ha una sola copia della blockchain quella si tiene ok? se ad un utente ad un certo punto siccome le blockchain poi vengono diffuse se ad un certo punto un utente si ritrova no? ad avere due copie della blockchain incompatibili tra di loro come nel caso di sotto incompatibili perché c'è una fork ok? allora l'utente che cosa fa? l'utente sceglie quella più lunga e butta via quella più corta ok? questo è quello che ad esempio se sopra il blocco BM più arriva un altro blocco BM più 2 e ad un certo utente arrivano le due versioni della blockchain quella con testa BM più 2 e quella con testa B' il primo m più 1 quest'ultimo la butta via perché è più corta e si tiene la più lunga se tutti quanti fanno così allora empiricamente non si può dimostrare formalmente ma empiricamente è dimostrabile che con una probabilità negligible la fork rimane ok? ma la probabilità è molto molto bassa in maniera naturale tendono a risolversi le fork da sole e quindi a rimanere un'unica copia della blockchain poi vi faremo qualche calcolo perché a quel punto allora uno potrebbe avere un dubbio e diceva bene la mia transazione è finita dentro la blockchain ok? ma io che garanzia ho che la versione della blockchain dove c'è la mia transazione non verrà mutata via perché c'è una fork che... mettetemi nei panni di un utente la cui transazione finisce dentro B' o Mp1 lui pensa che la sua transazione sia stata validata perché? perché è finita nella blockchain poi magari dopo due ore salta fuori che quel blocco è stato cancellato dalla blockchain perché fa parte di una fork più corta rispetto all'altra e quindi dopo due ore salta fuori che la mia transazione che io pensavo fosse valida invece non vuoi più quindi questo questo secondo significa significa che quando la mia transazione finisce in un blocco della blockchain io non ho la garanzia immediata che la transazione rimanga definitivamente nella blockchain c'è un lasso di tempo che deve passare prima che io questa garanzia ce l'abbia in maniera significativa poi vedremo quanto deve essere lungo questo lasso di tempo per darmi questa garanzia però se ci pensate tutto sommato è un qualcosa che è abbastanza comune anche ai sistemi di pagamento centralizzato voi immaginate di fare un bonifico attraverso il sistema bancario il bonifico non è mai istantaneo passa del tempo prima che la transazione venga completata e quindi prima che ci sia la garanzia che chi doveva ricevere il bonifico lo ha effettivamente ricevuto e qui succede la stessa cosa quando è registrato una transazione nella blockchain non avendo la garanzia immediata che quella ci rimanga deve passare un po di tempo prima di avere questa garanzia quindi prima di avere la garanzia che la vostra transazione si trova sul ramo più lungo che è una blockchain e che non venga tagliato da una qualche forza scopriremo che questo tempo che dobbiamo aspettare in realtà è molto breve non occorre aspettare tanto quindi questa è l'idea generale poi adesso andiamo a vedere come andare a implementarla usando le primitive crittografiche che conosciamo e cominciamo da due aspetti che in qualche modo sono già immersi uno è la firma le transazioni vanno firmate ok quindi ogni utente che vuole partecipare a questo diciamo a questa comunità deve avere una coppia chiave pubblica chiave private ok poi dovrà avere anche un portafoglio elettronico ok un wallet dove fare storage delle monete che vengono trasferite e come viene gestito il wallet ogni wallet ha un'identità ok perché ogni wallet ha un'identità questo serve per risolvere il problema della privacy che dicevamo prima nella blockchain bitcoin in realtà le transazioni non sono mai come scritto qui io Alice do a Bob una moneta con questo numero di serie ma sono sempre qualcosa del tipo io wallet numero X trasferisco una moneta trasferisco una moneta ad un altro wallet Y le identità delle persone che possiedono i wallet non compaiono da nessuna parte ok questo sposta il problema sull'identità dei wallet che identità diamo ai wallet allora la soluzione più semplice consiste nel dare al wallet una identità l'identità dell'identità viene chiamata address l'address del wallet è la sua identità che dipende dalla chiave pubblica associata a quel particolare wallet no perché abbiamo detto ogni utente ha bisogno di una coppia chiave pubblica chiave segreta per fare le firme e di un wallet ok quindi al wallet associata a questa coppia l'address del wallet si calcola a partire dalla chiave pubblica ok e l'algoritmo per generare la coppia di chiavi e l'address del wallet è questa sequenza molto complicata di operazioni che vedete qui la prima le prime due anzi no scusate la prima è l'operazione che si fa per creare la coppia no quindi quando voi aprite un vostro portafoglio di bitcoin la prima cosa che fate è creare la vostra coppia di chiavi la coppia di chiavi viene creata usando ECDSA che è quella l'algoritmo di quello schema di firma digitale basato sulla criptografia ellittica non so se vi ricordate che è basato su quella curva ellittica lì y al quadrato uguale a x al cubo più 7 quindi usando questo schema di firma digitale vengono generate le due chiavi SKPK dopodiché dal punto 2 in avanti vedete tutte le operazioni che servono per generare l'address del wallet a partire dalla chiave pubblica ok e questo perché? perché per far riferimento al wallet a cui voi volete trasferire un coin è sufficiente che voi conosciate la chiave pubblica del destinatario se voi conoscete la chiave pubblica del destinatario automaticamente usando questo algoritmo conoscete l'address del suo wallet e quindi e avete la garanzia che quello è il suo wallet e che nessun nessun man in the middle in the mezzo possa convincervi che il wallet di un utente che ha una certa chiave pubblica sia un altro diverso da quello legittimo perché bisogna anche pensare a questo tipo di di vulnerabilità ok ed è il motivo per cui questo procedimento che vedete è piuttosto complesso cioè se per legare in maniera indissolubile una chiave pubblica a un certo wallet e a rendere non invertibile il processo ok cosa succede qua dentro? vabbè lo vedete si prende la chiave pubblica si applica scia 256 dopo di che si prende un'altra funzione hash diversa da scia 256 e che fa parte sempre della famiglia sha e che si chiama ripen 160 e lo si applica di nuovo quindi si applicano due funzioni hash in cascata ok quindi i vari passaggi sono questi si parte dalla chiave pubblica si applica sha poi si applica ripenb ok poi si ottiene qualcosa che va avrappato all'inizio con un header di metadati che descrive qual è la versione del protocollo di bitcoin cui fa riferimento quel particolare portafoglio dopodiché si applica due volte sha di nuovo ok dopodiché si fa questo calcolo si prende una porzione dell'ultimo output e lo si somma al precedente e tutto questo per arrivare a ottenere una stringa di 25 byte ok e la questa stringa di 25 byte binaria la si converte in una codifica che è simile a quella esa dicimale e che ha questo nome qua b58check che praticamente converte la bit string di 25 byte che è lunga cioè bit string di 25 byte sono 25 per 8 bit quindi poco maneggevole la si converte in una in base a quella codifica in una stringa molto più corta vi farò vedere un esempio che è una una stringa che contiene sia numeri che lettere maiuscole che minuscole ok e questo è l'address no? quindi il risultato di questa procedura è l'address del wallet associato ad una certa chiave pubblica ripeto il motivo di questa procedura è di creare un binding sicuro e indissolubile tra chiave pubblica e portafoglio di riferimento ok poi veniamo all'altro problema torniamo qua quindi cominciamo a vedere effettivamente come le cose sono realizzate no? allora eravamo arrivati a dire che la transazione era qualcosa di questo genere no? e abbiamo appena confutato parte di questa questa cosa qui perché abbiamo detto che in realtà le identità non non sono specificate perché si fa riferimento solamente ai ai wallet e non e non agli utenti l'altra cosa che non compare nella transazione è il numero di serie della della moneta anche questo non serve ok togliere il numero di serie risolve un sacco di problemi perché usare un numero di serie solleva un problema chi decide qual è il numero di serie se non abbiamo un sistema centralizzato e quindi lo togliamo ma se lo togliamo che cosa identifica una moneta se non c'è l'identità della moneta cos'è che identifica in maniera univoca una moneta beh molto semplicemente siccome la blockchain è imbutabile e contiene tutte le informazioni relative a tutti i trasferimenti dal blocco Genesi a oggi ogni moneta da che cosa è identificata? è identificata dalla catena di trasferimenti che partono dal blocco Genesi il blocco Genesi stabiliva che esistevano mi ricordo quante un certo numero di monete possedute da da alcuni utenti identificati da una certa chiave pubblica il blocco Genesi è stato creato dal nulla ok quindi il blocco Genesi stabiliva che c'erano all'origine un tot di monete un certo numero di monete e che ogni moneta apparteneva ad una certa ad un certo wallet ok e probabilmente i padroni di queste monete create artificialmente nel blocco Genesi erano gli inventori del bitcoin ogni bitcoin in realtà non esiste il concetto materiale di moneta ma dopo lo vediamo dopo lo vediamo però l'idea l'idea qual è l'idea è che non esiste il concetto fisico di moneta da 50 centesimi di moneta da un euro ma esiste solo la catena di trasferimenti allora se te hai il blocco Genesi blocco creato dal nulla no l'inventore bitcoin questo è il primo blocco dentro questo blocco io ci scrivo che c'è un bitcoin che all'epoca non valeva nulla praticamente c'è un bitcoin il posseduto da questa chiave pubblica ok o chi c'è dietro no man mano man mano che si aggiungono blocchi alla blockchain questo viene trasferito quindi magari qui dentro c'è una transazione che dice che il bitcoin che in questo blocco era associato a questa chiave pubblica viene trasferito a qualcun altro ok poi questo magari un'altra transazione magari non qui ma più avanti c'è un altro blocco che dice che il bitcoin che apparteneva a pk primo viene trasferito al wallet di pk secondo quindi a partire dal blocco Genesi di ogni bitcoin voi potete ricostruire la catena di trasferimenti ok no no perché si può spezzare ad esempio in questo blocco lo vedremo nel dettaglio tu potresti avere una transazione che dice che un bitcoin appartiene al portafoglio di chiave pk poi magari qua tu potresti avere una transazione che dice che di questo bitcoin 50 centesimi vanno a pk primo e 30 centesimi vanno a pk secondo e 20 centesimi vanno a pk terzo quindi quel bitcoin lì si sta dividendo in tre sta dando origine a tre flussi ok e questa cosa si può moltiplicare quanto volete no quindi immaginiamo che nel blocco Genesi ci fossero 50 bitcoin faccio un esempio ora quei 50 bitcoin a partire dal blocco Genesi hanno creato una foresta di tante diverse transazioni trasferimenti e ogni volta che voi avete una porzione di bitcoin che vi deriva dalla transazione e voi la spezzate di nuovo quella si biforca di nuovo in ulteriori flussi e questa cosa si crea tanti flussi dove in testa al flusso ci sarà che cosa una porzione di bitcoin che deriva da una certa catena di trasferimenti che parte probabilmente non sicuramente dal blocco Genesi perché poi scopriremo che alcuni bitcoin non derivano dal blocco Genesi ma vengono creati coniati lungo la catena però in ogni caso ogni porzione di bitcoin che rappresenta un qualcosa che voi avete nel portafoglio ha alle spalle una catena di trasferimenti che voi potete ricostruire l'identità del bitcoin quindi non è un numero di serie ma è questa catena di trasferimenti quindi se voi nel vostro portafoglio avete 10 centesimi di bitcoin perché qualcuno vi ha pagato 10 centesimi di bitcoin quindi vuol dire che voi avete una transazione c'è una transazione nella blockchain da qualche parte che dice che voi siete i possessori di quei 10 centesimi ma da dove arrivano quei 10 centesimi arrivano dal trasferimento fatto da un wallet che magari aveva 20 centesimi di quei 20 10 vi l'ha dati voi e altri 10 sono finiti da un'altra parte quei 20 da dove derivano da un'altra transazione a monte e così via fino ad arrivare forse al blocco Genesi ok quindi voi siete possessori 10 centesimi di bitcoin che non hanno un numero di serie ma che sono il risultato di una catena di trasferimenti e il fatto che siete voi i possessori di quei 10 bitcoin è dimostrato dal fatto che nella blockchain non c'è una transazione che usa che spende quei 10 bitcoin 10 centesimi bitcoin verso qualcun altro cioè l'ultimo destinatario di quei 10 centesimi di bitcoin siete voi non è qualcun altro quando voi li spenderete ecco che non sarete più il padrone di quei 10 centesimi ma il nuovo padrone sarà quello che voi avete deciso che sia e allora a quel punto la catena si sarà allungata di un passo e quei 10 centesimi o meno perché magari voi quei 10 centesimi decidete di spezzarli ok quindi magari avete più di un destinatario che diventeranno i possessori della frazione di quei 10 centesimi e così due per sicuro sì allora se voi perdete la chiave segreta perdete il wallet anche se ce l'avete fisicamente senza chiave segreta voi perdete il wallet c'è una percentuale di bitcoin significativa sparsa per il mondo che si pensa che non abbiano più un padrone semplicemente perché sono dei bitcoin che non vengono trasferiti da anni il punto è come dicevamo prima il punto è che tornando qui voi per poter usare voi per poter usare un portafoglio un wallet dovete conoscere questa se no non potete usare il portafoglio perché perché questa vi serve per firmare il trasferimento del bitcoin quindi anche se voi sapete benissimo quali sono i vostri bitcoin perché lo leggete sulla blockchain ma se avete perso quindi magari conoscete la vostra chiave pubblica perché chiaramente ce ne è trazza sulla blockchain ma se avete perso questa anche se voi sapete dove sono i vostri bitcoin non li potete spendere siamo un brute force per sapere eh ma non non non il brute force attack su ecdsa non funziona cioè ci vogliono milioni di anni per ok quindi di fatto questi sono esempi reali eh cioè di di di address reali eh una transazione cioè l'identità di un bitcoin o di una produzione di bitcoin è qualcosa è una catena di questo tipo dove questi sono gli address questa è la codifica che vi dicevo prima perché serve per rendere più compatta la bit string che rappresenta quel digest calcolato in maniera complicata è una codifica che è un po' più compatta dove vedete ci sono sia numeri che lettere maiuscole e minuscole e rappresentano il risultato della manipolazione della chiave pubblica nel modo che abbiamo visto eh prima come si scrivono le transazioni dopo vi farò vedere un esempio le transazioni in bitcoin si scrivono usando un linguaggio di scripting che è il bitcoin script language che è un linguaggio estremamente semplice tant'è che non è un linguaggio touring completo non è un linguaggio di programmazione non è come in ethereum dove le transazioni le potete scrivere usando un linguaggio touring completo e quindi potete scrivere come vedremo mi accenderà qualcosa sui smart contract quindi cose più espressive le transazioni di bitcoin sono estremamente semplici e poco espressive anche perché seguono solo ed esclusivamente per trasferire bitcoin e nient'altro invece su altre blockchain si può fare molto molto altro come vengono costruite le transazioni e i blocchi entriamo un pochino più nel nel dettaglio ogni transazione ha i suoi metadati le informazioni significative che stabiliscono una una transazione sono queste sono la lista degli input ok cioè voi immaginate una transazione in cui Alice vuole trasferire 2,75 bitcoin a a bob ok quindi deve preparare una transazione in cui dice innanzitutto questi 2,75 bitcoin da dove arrivano ok sono tuoi dimostrami che sono tuoi da dove arrivano ok quindi nella transazione Alice deve specificare quanti e quali sono i gli input che mi servono per mettere insieme 2,75 bitcoin dove io nel mio wallet potrei avere 50 centesimi che provengono da una certa transazione potrei avere 20 che provengono da un'altra potrei avere 2 bitcoin che provengono da un'altra transazione quindi io nel mio wallet ho sì il saldo dei bitcoin che ho però di fatto ho l'elenco delle transazioni da cui provengono ok allora immaginiamo che io nel mio wallet che ne so abbia due transazioni una per un bitcoin e l'altra per due bitcoin no quindi io come lista degli input della transazione che voglio costruire devo mettere sia questa che questa ok cioè devo usare il bitcoin che mi viene da una certa transazione e i due bitcoin che mi vengono da un'altra quindi in totale fanno tre bitcoin io però ne devo spendere 2,75 non ne devo spendere tre ok dopodiché nella transazione io devo specificare chi sono chi sono i destinatari no allora io indico gli input e gli input sono due transazioni una da un bitcoin l'altra da due bitcoin poi dovevo dire questi tre bitcoin a chi vanno e in che modo allora magari io a bob ne devo dare 2,75 quindi dirò che uno dei destinatari è bob per un valore pari a 2,75 in realtà non è bob ma la la chiave pubblica di bob come vediamo e gli altri 0,25 a chi vanno gli altri 0,25 sono il resto no è come quando voi andate dal fornaio dovete spendere 2,75 gli date tre e lui vi dà il resto e qui succede la stessa cosa quindi gli 0,25 che avanzano vi devono tornare indietro quindi nella lista degli output ci sarà anche il vostro stesso wallet ok per una quantità pai all'exchange al resto quindi nell'esempietto che stiamo facendo voi avete dovete pagare 2,75 allora negli input avete due transazioni ok una che vi ha portato un bitcoin e l'altra che vi ne ha portati tre negli output avrete due destinatari uno è bob per una quantità pari a 2,75 l'altra è il vostro stesso wallet per una quantità pari al resto ok quindi è così che si finiscono per spezzarsi le monete quindi molto spesso voi stessi siete destinatari delle transazioni che fate se c'è un resto che dovete avere indietro poi dopo vi faccio vedere proprio il template di quali sono le informazioni che rappresentano la lista degli input e la lista degli output poi ci vuole l'identificatore della transazione che è sempre il doppio hash di queste due liste ok e poi c'è la commissione la commissione lo dice la parola stessa è ciò che voi pagate a chi risolve la proof of work del blocco che contiene la vostra transazione perché voi state preparando una transazione io lì ci voglio pagare 2,75 bob quando l'ho preparata cosa faccio? pubblico la transazione dico la pubblico alla comunità dico cara comunità io voglio registrare questa transazione nella nella blockchain ok è una transazione il cui valore è di 3 bitcoin perché comunque io sto spostando 3 bitcoin di cui una parte è il mio resto ma questo non ha importanza chiaramente chi prenderà questa transazione e la metterà in un blocco su cui risolve la proof of work deve essere premiato ok e da chi? da me è il mio interesse il mio interesse poi c'è anche vedremo un altro modo di premiare ma uno importante è questo il mio interesse è che la mia transazione finisca nel blocco che viene coniato da chi risolve la proof of work quindi io nella transazione aggiungo una commissione quindi che ne so il totale era 3 aggiungo uno 0,10 ok e questo 0,10 a chi va a finire? chi è il destinatario? per adesso è incognito lo scopriremo quando sapremo chi ha risolto la proof of work quindi in genere dentro una transazione la somma di tutti gli input è sempre un po' più alta della somma di tutti gli output ok perché è un po' più alta? perché la differenza rappresenta la commissione ok e quella differenza lì non ha un destinatario no? perché nell'esempio io metto in palio 3,10 bitcoin di cui 2,75 vanno a Bob 0,25 tornano a me 0,10 a chi vanno? non si sa non c'è un destinatario ok quel vuoto verrà riempito nel momento in cui alzerà la mano l'utente che dice io ho risolto la proof of work del blocco che contiene queste transazioni benissimo tutte le commissioni che sono dentro quelle transazioni finiscono nel mio wallet ok per cui quindi chi riesce a fare a risolvere la proof of work incassa la commissione che io decido di mettere lo dici da lì la commissione non è fissa questa non è fissa la dici da lì c'è quanto mettere nella propria transazione poi è un gioco di domanda e offerta se voi andate a vedere sui siti che vi fanno vedere come sta andando il bitcoin quanti blocchi sono stati minati quanto vale il bitcoin troverete anche una stima della della del rapporto che c'è tra la commissione che voi decidete di mettere sulla transazione e quanto tempo ci vuole perché la vostra transazione mediamente venga presa da qualcuno inserita nel blocco che viene minato perché chi fa il mining dei blocchi l'abbiamo detto prima decide lui quali transazioni prendere e mettere nel blocco su cui risolvere la proof of work e voi quale scegliereste come transazioni da mettere nel blocco quelle che hanno che vi garantiscono le commissioni più alto ma perché il vostro obiettivo è quello di guadagnare quindi più alta la commissione che voi mettete dentro la vostra transazione più è probabile che la vostra transazione venga scelta da essere inserita nel blocco che viene che viene cognato un uomo che viene cognato poi ci sono meccanismi per garantire un po' di equità le transazioni che aspettano da molto tempo acquistano priorità e quindi gli utenti poi sono obbligati a prendere transazioni che hanno priorità elevata questo per bilanciare ok questa è la struttura di uno dei modi di costruire le transazioni cosiddetto pay to public key hash transaction questa è la struttura ovvero la lista la lista degli input è fatta così ok cioè noi sappiamo che ogni transazione ha un identificatore quindi se io voglio dire tornando ad esempio di prima devo pagare 2,75 bene un bitcoin lo prendo da una certa transazione ok quale dico quale l'id della transazione in input di cui io ero a destinatarlo no perché se io ho un bitcoin vuol dire che c'è una transazione di cui io sono il destinatario chi è questa transazione devo mettere l'identificatore ok quale output dentro quella transazione perché ogni transazione l'abbiamo visto prima ha tanti output ok quindi non mi basta dire usa la transazione x per prendere bitcoin che io voglio spendere ma usa l'output iesimo dentro la transazione x quindi mi servono l'identificatore della transazione e l'indice all'interno della transazione che lui dice qual è l'output ok poi mi serve poi mi serve la devo devo dimostrare di essere io il destinatario di quella di quella transazione ok e lo faccio con una firma ok ovvero aggiungo queste informazioni che prendono il nome di unlock script è uno scriptettino che insieme alla transazione mi dice qual è la mia chiave pubblica ok e la firma che faccio ora perché ci metto la chiave pubblica perché lo vediamo come è fatto l'output facciamo un salto andiamo a vedere come è fatto l'output l'output è fatto così allora io l'indice perché posso avere tanti output dentro una transazione 1 2 3 4 5 quello che è quanto ci metto in quell'output quindi 2 2 75 nel primo output 0 25 nel secondo output 0 10 nel terzo output e il lock script che è uno script che contiene l'indirizzo del wallet del destinatario ok a chi va quindi torniamo un attimo nella sopra nell'input ok quindi io nel mio portafoglio avrò no una transazione vecchia di output che dice che che ne so un bitcoin è collegato è legato al mio wallet e io adesso quel bitcoin lo voglio spendere quindi quella transazione la voglio mettere come input di quella che sto preparando ok quindi metterò l'identificatore di quella transazione l'indice dell'output dentro quella transazione e poi devo dimostrare che sono io il proprietario di quel il riferimento di quell'output ok e quindi che cosa faccio ci metto la chiave pubblica la mia chiave pubblica nello script perché ci metto la chiave pubblica perché nella transazione c'è l'identità del wallet ok ma l'identità del wallet da dove deriva dalla chiave pubblica quindi io ci metto la chiave pubblica così chiunque può verificare che quella che ho messo qui è effettivamente la chiave pubblica associata al wallet che ha incassato il bitcoin che io voglio spendere ok poi devo dimostrare di avere la chiave segreta relativa a quella chiave pubblica e come lo dimostro con una firma e per quello che vi dicevo senza chiave segreta voi bitcoin non li spendete perché senza questa firma qui non potete trasferire bitcoin ok quindi questa operazione vi serve per dimostrare che l'output di una certa transazione che ha un certo valore è vostro e lo potete spendere come lo spendete lo specificate qua nella lista degli output e dite un certo tot va dalla parte un tot va dall'altra e così via tutto quanto di nuovo lo firmate perché dovete firmare anche questa roba qua perché se no potrebbe essere modificata un avversario potrebbe modificare la lista dei destinatari del vostro trasferimento questo è il template della vostra transazione quindi da dove vengono i bitcoin che volete spendere con la prova del fatto che sono vostri e a chi li volete dare tutto quanto è firmato voi pubblicate questa transazione pubblicare significa distribuirla tra tutti i partecipanti tutti i membri della comunità finché non ce ne sarà uno tra questi che prenderà la vostra transazione la metterà dentro un blocco risolverà la proof of work di quel blocco e il blocco finirà nella blockchain questo è il modo in cui funziona ok quindi il ciclo di vita delle transazioni è quello che abbiamo appena detto le transazioni se voi avete un'applicazione sullo smartphone per la creazione della transazione questo diffonderà la transazione tra quelli che vengono chiamati full node della comunità bitcoin che sono nodi che registrano e diffondono le transazioni che si dite pendenti perché sono transazioni che devono essere ancora completate di solito i full node verificano anche che la transazione sia scritta bene e che sia corretta quindi verificano le firme tutto quello che va fatto ok di solito distribuita nella nella nella comunità oltre alla blockchain però la blockchain immaginate anche voi è un qualcosa di estremamente grande e quindi andare a verificare che la vostra transazione rispetto alla blockchain è corretta può essere una cosa che porta via del tempo perché dove è in quale blocco è la transazione che io sto usando allora in genere la comunità condivide anche un reposito ridistribuito che è l'insieme di tutte le transazioni in output che non sono ancora state spese e quindi per verificare la correttezza di una transazione in genere basta andare a vedere qua dentro se effettivamente io sto spendendo bitcoin che sono spendibili e quindi evitare il problema della però questa è una questione di efficienza per evitare il problema del double check del double spending dopo di che le transazioni pendenti rimangono in attesa in gergo si chiama mempool l'insieme di tutte le transazioni che stanno aspettando di essere inserite in un blocco esiste un protocollo che si chiama stratum arrivato dalla versione 2 che è il protocollo per la gestione della mempool cioè il protocollo che viene utilizzato da chi vuole proporre una transazione quindi per inserirla nella mempool e da chi fa il mining dei blocchi chi fa il mining dei blocchi prende sceglie le transazioni dalla mempool le usa per riempire un blocco e risolvere la proof of work del blocco ok ci sono una serie di vulnerabilità delle vecchie versioni di stratum che ad esempio consentivano ad un avversario di sottrarre a chi faceva mining del blocco le commissioni quindi di reindirizzare il destinatario delle commissioni poi tra l'altro la prima versione di stratum era anche poco efficiente perché c'erano parecchi casi di mining di blocchi vuoti ovvero utenti che facevano risolvevano la proof of work di un blocco vuoto ok senza senza metterci dentro le transazioni voi direte ma a che cosa serve fare mining di un blocco senza transazioni quindi è un blocco che non mi frutta delle commissioni serve perché c'è un altro meccanismo di rewarding che premia gli utenti per il semplice fatto di aver coniato un nuovo blocco ok quindi anche coniare un blocco vuoto che è legale si può fare adesso diventa sempre più raro trovare blocchi vuoti nel blockchain ma all'inizio nella blockchain alcuni blocchi vuoti al giorno venivano coniati quindi nella prima parte della blockchain si trovano i blocchi vuoti e questi venivano comunque pagati diciamo a chi aveva fatto il mining con la nuova versione di stratum questo è un evento sempre più sempre più raro insomma come sono fatti i blocchi e come memorizzano le transazioni un blocco è circa un file di un mega quante transazioni può contenere dipende appunto da quanto da quanta informazione c'è dentro le transazioni anche un migliaio di transazioni possono stare dentro un blocco come fanno gli utenti che fanno mining dei blocchi a scegliere le transazioni da mettere nel blocco come dicevo prima si basano sul valore delle commissioni per massimizzare il valore del blocco ma anche sull'età delle transazioni pendenti perché le transazioni che aspettano da molto tempo aumentano di priorità e anche il valore perché di solito transazioni che hanno un valore alto hanno anche commissioni un po' più alte quindi questo può aumentare un po' il valore come viene costruito il blocco chi fa mining prende le transazioni riempie il blocco siccome possono essere tante come vengono organizzate le transazioni all'interno del blocco attraverso un merkel tree ricordate come funzionano i merkel tree perché attraverso un merkel tree perché chi fa mining del blocco deve garantire l'integrità del blocco io risolvo la proof of work di un blocco lo pubblico nella blockchain ma che garanzia do che il blocco che vado a pubblicare nella blockchain è integro e nel frattempo non non è stato alterato di nuovo si usano le funzioni hash allora l'idea qual è l'idea è che uso le transazioni del blocco come i tanti record di un file sopra il quale costruisco il merkel tree ricordate come funziona il merkel tree a livello delle foglie ci sono i record del file poi ai livelli interni dell'albero che viene costruito si applicano ripetutamente le funzioni hash fino ad arrivare alla radice del merkel tree dopodiché costruisco una volta che ho fatto questa operazione quindi nel blocco ci sono le transazioni e c'è il merkel tree dopodiché costruisco leader del blocco che contiene alcune informazioni fondamentali che sono queste contiene il riferimento al blocco precedente ovvero a quella che attualmente è la testa della blockchain perché io sto cercando di costruire un nuovo blocco lo devo attaccare a quella che adesso è la testa della blockchain come faccio ad attaccarglielo ci metto il digest del blocco che attualmente è in testa della blockchain ci metto la radice del merkel tree del leader questo mi dà la garanzia che qualunque controllo di consistenza fatto su una transazione attraverso la radice del merkel tree viene validato oppure no bisogna di meccanismi che conosciamo poi ci sono altri metadati compreso il famoso nonce che dicevamo all'inizio ok il gioco della proof of work consiste nel prendere leader quindi non tutto il blocco solo leader propone che usiamo il merkel tree perché tutte le informazioni del blocco relativamente le transazioni che stanno nel blocco sono condensate nella radice del merkel tree quindi si prende solo leader con link al blocco precedente la radice del merkel tree più altri metadati più il nonce scelto da chi fa mining ok il digest di tutte queste informazioni deve essere un valore che comincia con non so questo forse non è aggiornatissimo deve essere un valore che comincia con 72 veri poi può variare ok quindi ripeto chi vuole fare mining di un nuovo blocco prende tutte le transazioni che può le scrive dentro il blocco il corpo del blocco calcola il merkel tree sopra queste transazioni e nel leader del blocco ci mette la radice del merkel tree il digest del blocco della blockchain qui attaccare quello che io sto coniando e il nonce che rappresenta la proof of work ok che io devo trovare la brute force la faccio sul nonce perché il digest calcolato con SHA256 di tutte queste informazioni compreso il nonce deve essere una stringa che comincia con 72 circa ok circa perché perché si cerca di mantenere una sorta di equilibrio ovvero il fatto che mediamente ci vogliano circa 10 minuti per coniare un nuovo blocco no e come si fa a mantenere questa quantità di tempo più o meno costante perché questa quantità di tempo da che cosa dipende innanzitutto dipende da quanto è grande la comunità più grande la comunità maggiore è la potenza di calcolo della comunità e quindi maggiore la probabilità che in poco tempo qualcuno facendo il brute force sul nonce trovi la soluzione al puzzle e quindi pubblichi il blocco quindi se la comunità è variabile e il tempo è variabile invece il tempo non vogliamo mantenere costante ok quindi quando la comunità cresce questo numero qui deve crescere perché deve aumentare la difficoltà più grande è questo numero più è difficile trovare la proof of work ok se la comunità invece si riduce allora questo numero si abbassa e quindi in questo modo abbiamo la garanzia più o meno che ogni dieci minuti al mondo viene coniato un nuovo un nuovo blocco ok quindi è molto importante l'uso del Merkel tree per questione di efficienza e per questione di integrità no perché alla fine il nonce per come è stato calcolato e per come è costruita la proof of work vi dà una garanzia del contenuto informativo del leader ok ma siccome nel leader non solo c'è riferimento al blocco precedente quindi questo vi dà la garanzia dell'immutabilità di tutta la catena ma c'è anche la radice del Merkel tree quindi se qualcuno prova a modificare dentro un blocco una transazione salta la prova di integrità basata sulla sulla radice del Merkel tree e quindi in questo modo abbiamo la garanzia dell'integrità delle delle transazioni ok e anche del fatto che finché il blocco non è pubblicato nella blockchain abbiamo comunque la garanzia che nessuno lo ha modificato rispetto a quando è stato fatto il mining ok e l'altro meccanismo di rewarming che non vi ho citato è quello che vedete qua ovvero chi riesce a fare mining di un blocco non solo incassa le commissioni presenti nelle transazioni ma incassa anche un premio ok questo premio è fisso e viene aggiornato periodicamente e questo premio è associato ad una transazione che in ogni blocco c'è sempre e che si chiama coin based transaction è una transazione un po' particolare è la prima transazione di ciascun blocco ed è una transazione un po' particolare perché è l'unica transazione che non ha input ma che ha solo output ok tutte le transazioni hanno input e output perché io posso solo trasferire no bitcoin che sono in mio possesso ma una transazione senza input e che però ha un output e l'output corrisponderà al portafoglio di chi ha fatto il mining è una transazione che genera dal nulla nuovi bitcoin ok quindi la coin based transaction serve per coniare nuovi nuovi bitcoin inizialmente il reward era di 50 bitcoin per ogni nuovo blocco poi questa quantità è andata dimezzandosi la regola è una volta ogni 210.000 nuovi nuovi blocchi e quindi questa è un po' la tempistica dei dimezzamenti che ci sono stati più o meno ogni 4 anni lo sommo quindi quindi nel 2012 è diventato 25 nel 2016 è diventato 12,5 nel 2020 6,25 adesso il reward è 3 insomma la metà di 6,25 quindi il reward va diminuendo però comunque bilanciato dal fatto che ci sono le commissioni il motivo di questo meccanismo qui dipende dal fatto che era intenzione dei creatori originali avere un sistema che non crescesse all'infinito in cui il mining il conio di nuovi bitcoin fosse limitato la stima è che nell'arco di un centinaio d'anni se esistevano ancora si raggiungerà questo questo limite che è lo sappiamo già attorno ai 21 milioni di bitcoin su questo sito forse questo è un incattivo aspetta un attimo forse lo faccio così su questo sito si trovano un po' che però devo condividere un attimo ok andiamo a condividerlo ecco questo è il countdown che dice quanto manca al prossimo alla prossima riduzione il valore che dicevo prima è questo qua 3,125 bitcoin è il reward che attualmente viene pagato a chi valida nuovi blocchi cosa cosa ho condiviso sbagliato no va bene ok altre curiosità relativamente al discorso della probabilità per un avversario di riuscire a validare una fork a suo piacimento visto che c'è comunque il problema delle fork dicevamo poco fa appunto che una una transazione possiamo dire che è confermata e non verrà tolta dalla blockchain se si trova nella lista più lunga ok come facciamo come facciamo a stimare la lunghezza della lista più lunga l'idea l'idea è che la probabilità che una certa fork venga annullata dipende dalla lunghezza della fork voi immaginate di essere in una situazione di questo genere questa è la blockchain va in a fine un certo punto ma immaginiamo che qui ci sia un fork ok e per un po' di tempo la fork si diffonde le due forche si diffondono no è ovvio che man mano che una fork allunga la propria lunghezza aumenta la probabilità che quella diventi la versione definitiva no e diminuisce la probabilità che venga in qualche modo invalidata da un'altra fork in una situazione come quella che ho appena disegnato molto probabilmente questa verrà cancellata la probabilità che questa fork qui cresca superando la lunghezza di questa è molto piccola perché vorrebbe dire che un certo pool di utenti della comunità si mettono d'accordo per far crescere questa e bloccare questa però ci vuole molta potenza di calcolo per far crescere una fork di una quantità di blocchi lunga piacere perché nel frattempo magari c'è la parte onesta della comunità che sta facendo crescere questa quindi bisogna per far crescere una fork a proprio piacimento ci sono alcune stime che sono basate appunto sulla congettura dell'attacco del 51% che ci dice questo che se un blocco è già preceduto già superato da 5 blocchi sopra di lui ok quindi se voi vi trovate che ne so diciamo che questa sia andata avanti 1, 2, 3, 4, 5 supponiamo che la vostra transazione sia qui ok e che quindi sopra questo blocco gli siano stati aggiunti altri 5 quindi la probabilità che questa intera fork venga annullata perché altrove ne è cresciuta una più lunga e quindi un avversario possa di fatto fare double spending perché questa che gli ha permesso di spendere di bitcoin viene annullata e poi magari gli stessi bitcoin li spendono da un'altra parte ebbene la probabilità che questo avvenga è pari a 10 alla meno 12 che è negligible supponendo che l'attaccante controlli l'1% del potere del risorso di calcolo dell'intera comunità che è tantissimo così come c'è un'altra congettura che invece dice che se l'attaccante possiede più della metà della potenza di calcolo dell'intera comunità allora può fare quello che vuole può far allungare una forca quanto vuole poi segarla a favore di un'altra e quindi può di fatto compromettere la proprietà relativa alla capacità di fare double spending ok quindi in genere per le transazioni comuni si assume che quando più o meno è passata un'ora da quando è stato coniato il blocco che le contiene perché 5 blocchi sopra quella che contiene la nostra transazione significa aspettare un'oretta visto che viene coniato ogni 10 minuti quindi quando la vostra transazione è entrata nella blockchain dopo circa un'ora quindi quando 5 o 6 blocchi sono stati aggiunti sopra di lei avete una garanzia che quella sia definitiva abbastanza significativa cioè la probabilità che venga confutata è negligible l'unica eccezione viene fatta sulle transazioni del coinbase cioè quelle transazioni che coniano nuovi bitcoin come reward per quelle transazioni lì bisogna aspettare 100 conferme quindi quando un minatore incassa il reward per aver minato un nuovo blocco prima di spendere i bitcoin del reward deve aspettare 100 ulteriori blocchi quindi 100 per 10 minuti non mi ricordo quanto fa però non è un tempo esagerato questo è quello che succede giusto per fare e chiudere per fare per quantificare un po' che cosa significa controllare il 51% della potenza di calcolo dell'intera dell'intera comunità allora la potenza di calcolo dell'intera comunità prende il nome di hash rate perché rappresenta la quantità di operazioni hash SHA256 che sono quelle che dovete fare per risolvere il puzzle della proof of work per unità di tempo quindi al secondo quindi mi ricordo se ho qui il link da qualche parte dopo ci guardiamo c'è un sito che vi dice in tempo reale qual è l'hash rate mondiale ok che viene misurato attualmente in terra hash ok quindi miliardi di operazioni hash al al secondo dove ogni operazione è un calcolo SHA256 quindi questo questo vi dà un'idea di quella che è la potenza di calcolo che al mondo viene impegnata in tempo reale per risolvere la proof of work c'è stato un episodio quattro anni fa abbastanza interessante per cercare di che ha aiutato a capire dove fossero concentrate le risorse computazionali all'epoca si pensava che la Cina rischiasse di superare la soglia del 51% e ci fu un incidente ad aprile del 2021 che provocò un blackout in un'intera regione della Cina dove erano concentrate parecchie server farm dedicate solo e esclusivamente al mining di blocchi di bitcoin quindi facendo due calcoli su l'area che è stata investita dal blackout quanto è durato il blackout e quante server farm cinesi sono state bloccate e andando a vedere nello stesso arco di tempo quanto è calato l'ash rate mondiale del bitcoin in quel momento ebbene si è arrivati ad una stima che è questa qua per cui in quel periodo all'incirca un terzo della potenza di calcolo mondiale risiedeva tutta in Cina quindi ancora abbastanza lontano dalla sogna fatidica del 51% che se venisse superata manderebbe gamballare l'intero sistema perché diventerebbe insicuro ok poi le cose col tempo sono cambiate la Cina ha bannato la le crypto currencies come bitcoin e quindi non è più non si può più fare mining di di di criptovaluta in Cina quindi gli equilibri si sono un po' spostati questi sono dati che ormai sono vecchi di un anno e mezzo che dimostra poi è cambiato naturalmente la Russia è poi calata di nuovo diciamo che a livello mondiale la distribuzione delle risorse di calcolo va di pari passo col costo dell'energia cioè dove l'energia costa di meno trovate più server farm bitcoin perché perché costa di meno implementare la la proof of work questo è una slide che invece fa vedere quanto è ecosostenibile il meccanismo della proof of work di bitcoin non lo è per niente perché di nuovo anche questo è un dato abbastanza vecchio ma non non si è spostato di tanto negli ultimi anni e fa vedere che la quantità di energia spesa annualmente per tentare di coniare bitcoin si colloca al 34esimo post della classifica mondiale dei consumi di energia a livello di interi paesi quindi nel 2021 la potenza di calcolo l'energia spesa per fabbricare bitcoin superava il fabbricone di energia annuo di paesi come il belgio le filippine il kardachistan è quasi allo stesso livello dell'olanda insomma intanto per darvi un'idea e questo è uno dei motivi per cui in soluzioni successive delle blockchain si è affermate si sono affermate tecniche alternative per gestire la proof of work in maniera più ecosostenibile è il caso di ethereum che ha un linguaggio di scripting che ha solidity più potente di quello di bitcoin le transazioni ethereum sono cosiddetti smart contract con i quali si può programmare qualunque tipo di procedura la cryptocurrency di ethereum è l'ether che si utilizza per pagare l'esecuzione degli smart contract in misura proporzionale alla potenza di calcolo richiesta dagli smart contract che viene misurata in gas ma la cosa interessante di ethereum è che il processo di mining non si basa sullo proof of work proprio perché questa costa ma su la proof of stack che usa delle primitive leggermente diverse ma che dal punto di vista criptografico ma che non si basa più sulla risoluzione del del crypto puzzle che dicevamo prima e non ce l'ho il link alla pagina dove c'è la stima temporale del hash rate però si trova facilmente se googlate lo trovate facilmente e basta ci sono un sacco di questioni aperte sul discorso relativo a proprietà di sicurezza delle blockchain in generale non mi riferisco solo a bitcoin ci sono tanti spunti interessanti relativi ad esempio allo studio di vulnerabilità degli smart contract e attacchi condotti contro diverse blockchain come appunto Ethereum bitcoin nel caso di bitcoin gli attacchi più significativi di solito sono quelli portati nei confronti dei protocolli di gestione dei wallet piuttosto che della mempool ma non alla blockchain in quanto tale comunque di vulnerabilità ce ne sono parecchie nell'ambito delle blockchain quindi potrebbe benissimo essere un tema che può essere approfondito in un progetto e se poi avete delle curiosità su questo me lo dite vi do i riferimenti del caso perché questo chiude il discorso che volevo farvi di approfondimento relativo ai bitcoin alla blockchain di a un o