ora ti facciamo un'altra esercitazione con Raspberry Pi dove ci abbiamo installato sotto lo shield quello che si chiama SenseApp che abbiamo provato l'ultima volta quello acquistato e la cosa che andiamo a fare è provare a scrivere nel database fatto per le sede temporali che si chiama InfluxDB. Allora noi abbiamo un'installazione di InfluxDB in cloud che oggi useremo e proveremo a inviare dati proprio su questa installazione. Quindi a casa se avete un Raspberry Pi con SenseApp potete seguire proprio passo passo quello che facciamo altrimenti come potete immaginare la shield SenseApp serve solo per per ricevere dei dati quindi per campionare dei dati. L'importante è che abbiate qualche cosa da inviare su InfluxDB. Allora intanto prepariamo vediamo subito prima di fare ripartire con la scrittura del codice vediamo l'installazione che abbiamo dove è raggiungibile e in che modo possiamo consultare le informazioni così ci prepariamo allora io condivido ok condivido il browser perché arriveremo a questa installazione attraverso HTTPS quindi aprite anche voi una shell in questo modo l'indirizzo è HTTPS slash 93 186 punto 186 punto 154 punto 118 la porta è 80 86 punto 154 punto 154 punto 154 quindi se nel browser scrivete atttps slash 93 punto 186 punto 254 punto 188 2 punti 80 86 che è la porta non funziona perché non funziona vediamo se ho sbagliato qualcosa così funziona senza la S scusate senza la S HTTP sì 80 86 dovreste vedere qualcosa di questo tipo allora i credenziali li dobbiamo mettere adesso se questa installazione qua l'abbiamo fatta noi ce l'ha fatta Paolo su cloud ha installato questo influx di B che è nostro è solo nostro quindi ci possiamo lavorare noi ci abbiamo le credenziali e ha creato degli account studente quindi se voi raggiungete riuscite a raggiungere la shell che vedete di login su VB allora le password o meglio l'utente è studente e la password la vado a riprendere uniurb2021 tutto minuscolo uniurb2021 ok una volta fatto il login entrate proprio nel un foto di influx di B come l'avevamo già visto altre volte è un database che stiamo usando adesso per testing quindi se andate su explore già trovate qualcosa vedete se andate su explore in basso a sinistra trovate esercitazioni questi sono i bucket cioè appunto i raccoglitori che noi potremmo intenderli come i database ce n'è più di uno monitor in tasca esercitazioni uniurb01 noi useremo esercitazioni oggi esercitazioni che praticamente è vuoto in questo momento ok quindi vedremo apparire i nostri dati se ci riusciremo appunto a inviare li vedremo apparire qua uniurb2021 tutto minuscolo e questo DB rimarrà acceso diciamo così per sempre quindi anche per il vostro progetto d'esame alla fine potrete usare comunque questo DB qua io vi lascerò un token per poter scrivere e leggere il DB e quindi potrete dire ok faccio il mio il mio progetto magari in quel caso avrete un bucket personalizzato invece di andare su esercitazioni se uno siccome il progetto va concordato prima con me se voi mi dite però mi serve un'istanza di influx DB tranquilli io vi do un bucket qua sopra magari il bucket lo chiamiamo proprio nome e cognome così lì su potete lavorare solo voi vi do il token e a quel punto il vostro progetto può scrivere lì sopra come vi avevo già detto potete anche usufruire in alternativa di influx DB gratuito con un account Gmail quindi su cloud semplicemente avete solo il problema della ritenzione che al massimo è 30 giorni però potrebbe andare bene allo stile ok allora noi abbiamo già pronti dei token quindi l'altra cosa che adesso andiamo a fare vediamo un po' su qui vediamo tokens hanno riuscito a vederlo quindi come ve lo passo il token perché allora l'account studente non ha possibilità di creare token per scrivere quindi quest'account qui con cui siamo entrati non è non vi dà la possibilità di riscrivere il token l'abbiamo creato con l'account più potente che è quello diciamo così adesso io questo ve lo incollo su blended perché chiaramente se dirà questa esercitazione non ve lo posso dettare allora io lo copio e lo incollo su blended quindi voi l'andrete a copi e incollare per poi portarlo dentro il vostro codice python e la raspberry ok quindi lo vado a mettere immediatamente su blended uniurb lo mettiamo in cima tra le informazioni quindi attiva modifica aggiungo un'etichetta token per inserire dati su influx db senza il doppio accice finale sì, c'è così voi lo potete copiare da lì non ho capito, scusami quindi voi con Raspberry dovreste chiaramente loggarvi su wifi altrimenti non vi fa uscire una volta loggati su wifi andate su blended fate login anche lì e accedete a questo token che ci servirà appunto spedire per ogni transazione fatta sul nostro db altrimenti ce lo rifiuterà ok quindi ci siamo quasi direi adesso vado torno a fare ma è un po' di giorni così ricarichi e dopo a un certo punto va ci vede che va un po' esagerano il numero di connessioni sì ok allora io torno su risvermi bene adesso quello che lo trovate ce l'abbiamo e quindi iniziamo la nostra esercitazione voglio solo vedere una cosa ok bene allora la prima cosa che dobbiamo fare perché non ci non mi ricordo se è stata fatta su tutte le le vostre raspberry e fare l'upgrade di pip quindi del manager di python perché altrimenti ci può dare dei warning quindi la cosa che andiamo a fare la faccio anche io sulla mia aprile una shell facciamo un studio questo momento un po pip install meno meno upgrade io non sono connesso vediamo cosa fa perché si sta processando anche da voi cosa dice che non a me alla fine dice che la situazione è avvenuta con successo mi dice che c'è la 18.1 però alla fine mi dice che ce l'ha fatta non lo so anche a voi vi dice così perché la tua è più avanti perché la tua è più avanti io questo punto sì certo ma esatto sono proprio dei cloni queste macchine la vedo strana questa cosa vabbè comunque sembrerebbe alla fine esserci riuscito adesso proviamo vediamo siete ancora i warning però doveva essere solamente un problema di vuole quello che si avrebbe generato allora quindi andiamo su programmazione il nostro toni python partire e qui ciò le cose della volta scorso lo chiudo il button e facciamo un new facciamo subito un save lo url no lo metto anche quello lì sotto giusto sì sì allora lo chiamiamo prova influxdb comunque adesso lo vado a mettere di là perché è corretto ci sia esatto allora ma anche perché poi dovremo comunque anche metterlo all'interno del python questo codice chiaramente e cioè l'url del server altrimenti non ci arriveremo mai quindi vado a modificare questa etichetta che avevo messo prima modifico l'etichetta quindi soppravviamo il token prima del token ci metto indirizzo server ok adesso c'è anche su ce l'abbiamo anche su il nostro blended quindi url del server che http quindi non è http doppio due punti 76 93 186 254 118 288 86 quanto numero è il suo? ecco questo lo trovate anche su blended allora abbiamo detto ecco questo ok adesso dovremo avere tutto quindi direi che possiamo provare con la versione influxdb 2.0 a vedere cosa succede ok quindi benissimo bene ok ci siamo quindi torniamo nella nostra raspberry e abbiamo fatto questo nuovo file prova includibit.python e iniziamo con gli import quindi aumenta un po' era studente e la password uniorb 2021 ok quindi facciamo from data time import date import import ci serve la la libreria per il calendario poi ci servono le librerie per accedere a sense at quindi quindi from from sense underscore at import sense at e poi anche la solita time quindi from time andiamo a fare l'import di slip ora ci servono invece le librerie che sono state preinstallate su le le raspberry per invece le librerie per scrivere su influxdb quindi queste sono from influxdb underscore client import quindi from influxdb underscore client andiamo a fare import di influxdb client andiamo a importare point e andiamo a importare sprite precision chiaramente anche qui c'è per fortuna una documentazione molto ampia di queste librerie in influxdb in python che sono a prescindere dalla piattaforma in cui le installate quindi in realtà sono valide anche per ci si è detto ma necessariamente per la nostra verbi poi una seconda riga from ancora influxdb underscore client andiamo ops no che deve fare client scusate dobbiamo fare di più from influxdb client punto client punto write underscore api dobbiamo fare import di in croc 1 2 queste librerie python permettono tutto grande permettono di scrivere sia in maniera sincrona che in maniera asincrona qual è la differenza? sincrona la scrittura avviene immediatamente e sarà possibile anche specificare un time out quindi dici ok se riesci a farla dentro top secondi bene altrimenti la ripetiamo oppure farla asincrona asincrona vuol dire io ti invio questo dato e poi dimmi tu quando lo riuscirai a scrivere nel nostro caso essendo il server nulla facente non ci sarà nessun tipo di problema fare le scritture sincrona in quanto appunto è un server dedicato a noi non sta facendo assolutamente nulla quindi bene e a livello di import siamo a posto quindi vediamo se l'ho scritto bene client punto client write API input sincrona perfetto bene a questo punto definiamo definisco una stringa per contenere il token di scrittura lettura in realtà è un token che serve proprio per potersi connettere noi chiamiamo my token uguale aperta il pedice il pedice e andiamo a incollare quella che vi ho passato su ehm vado anch'io così che trovate su blended vediamo se ci riesco anch'io ad accedere col browser da qui adesso adesso noi tu che non mettiamo hardware nel codice ma chiaramente uno lo metterà in un file di configurazione lo andrà a leggere un'area in un ambiente si qualcuno lo mettiamo direttamente nel codice ma chiaramente questa è una scorciatoia allora Blending. Ok. Ok. Ok. Ok. Ok. Ok. Adesso dovrei riuscire a copiare il token. Ok. Ok. Ok. Ok. Ok. Ok. Ok. Ok. Ok. Ok. Ok. Ok. Ok. Eccoci qua il nostro token. Perché quando andiamo a fare una conversione su InfluxDB, chiaramente servirà lo URL, servirà il token che potrei scrivere, ma serve anche l'organizzazione. Quindi my.org prenderà e l'organizzazione che noi abbiamo predisposto sul nostro DB si chiama UniURB, quindi molto facile. Ok. Ok. Quindi avremo my token, my.org, con tutto questo andremo a comporre la query di scrittura. il bucket, my bucket, che sarà esercitazioni, tutto minuscolo. Ok. Ok. Ok. Ok. Ok. Andremo anche a mettere my host, che identifica, visto che saremo in tanti a scrivere lì sopra, identificherà la Raspberry Pi. Quindi la Raspberry Pi adesso non hanno, forse hanno un numero che Paolo ha scritto da qualche parte. Sì, io ad esempio ho il numero 7, quindi io scriverò. Se l'avete scritto da qualche parte? No, se l'avete scritto da qualche parte. Ah, ok. Quindi la ha nominato esattamente così. Quindi io metterò Raspberry, metto N7, visto che è la mia numero 7. Così appunto lo stream di informazioni che viene dalla mia sarà diverso da quella che viene dalle vostre. Quindi. Bene, e questo è tutto ciò che ci serve per creare la connessione. Tutti i parametri di connessione. Quindi, metto sopra add i parametri di connessione. Quindi definisco la stringa e i parametri di connessione che sono questi qua. Bene. Ah, non abbiamo messo lo URL, scusa. massimo myurl sarà uguale http2.133.133.164.118.8086. Quindi ci stiamo in un concorso che poi non lo... Sì. Eh sì. Penso che si possa anche configurare con HTTPS. No, nel senso non ha una porta particolarmente. Allora, noi c'è l'apporto 8086 in questo momento, che abbiamo abilità. Però quando installi il server lasciagli tu. Sì, è la stessa che usi un'interfaccia del browser. Sì, è la stessa che usi un'interfaccia del browser. È configurabile chiaramente però... Come? Sì, immagino sì. Bene. Adesso ci abbiamo tutto e iniziamo invece a interrogare SenseApp. Quindi... Creo un'istanza di SenseApp per raccogliere i dati. Quindi, come l'altra volta, la chiamiamo Sense. Prende SenseApp. Non abbiamo bisogno di nessun parametro. Facciamo un Sense.Clear che è consigliato. Il SenseClear dovrebbe cancellare lo schermo e in qualche modo inizializzare i sensori. Quindi, SenseApp è pronto a reagire. Ora invece dobbiamo creare... Creo... Distanza di... Influx... B... Client... Che sarà appunto l'oggetto che ci permetterà di scrivere. Client... Client... InfluxDB Client... Attenzione, chiaramente alle maiuscole e minuscole, visto che è case sensitive. Client... I parametri di connessione saranno... L'url che prende... My... Url... Token... Che prende... My... Token... My... Token... Token... Token... che prende... My... Token... prende mytoken.org, invece host che sarebbe il nome della nostra Raspberry locale e il bucket verranno usati nella query di sotto, quindi la connessione si regge solamente su URL, token e org, mentre il bucket, la misura eccetera viene passata dopo. Bene, ora dobbiamo... Ora dobbiamo... Inizializzo l'API di scrittura in modo in crono. Abbiamo questa scelta e quindi insalizziamo una write API che deriva da client.write API e passiamo il tag. Come write options. Options. Il tag sincrono. No, è sincrono. Ne abbiamo importato sincrono. Ok. Sì, perché possiamo scegliere, come vi dicevo... Abbiamo importato sincrono, ma possiamo anche utilizzare asincrono. E probabilmente per questa necessitazione non sarebbe cambiato nulla, visto che esiste un server, comunque non sta facendo nulla. Bene. Adesso dobbiamo... Prima di tutto estrarre un po' di dati da Sensat, che abbiamo solamente inizializzato, e poi passarli con certa struttura, visto che dobbiamo scrivere in una maniera, diciamo così, taggata. Cioè i dati devono essere taggati, come sapete, nell'IoT. Allora, l'ultima cosa che faccio è... Leggo... Leggo... Temperatura... E predispongo un temp, che sarà uguale a sense... Si faceva come un get temperature... Si... Get temperature... Temperature... Temperature... Temperature... That中... nämlich... Capmia... durch...ábker... nuestro... Minnesota... ... Adesso sono pronto per scrivere temperatura e umidità. Quindi creiamo un oggetto point, visto che abbiamo importato point di sopra, point è un punto che andrà ad essere inserito nella serie temporale, quindi lo chiamiamo point1, uguale a un oggetto di tipo point. Il primo parametro da dare il point è il nome della misura. Vi ricordate che l'equivalente delle tabelle in qualche modo su InfluDB si chiamano misure. Lo scegliamo noi il nome della misura. Come vedete noi abbiamo predisposto il nostro dataset, il nostro database, semplicemente con il nome del to, il bucket, chiaramente, che è il db, che si chiama esercitazioni. Adesso diciamo noi qui sopra andare a mettere la misura. Quindi il primo argomento è la misura, passata come string. Se la misura non esiste viene creata. Ok? Da se fai un typo, se non sbagli un carattere, si crea poi un'altra misura. Ecco, qui come misura potremmo addirittura, io direi, separarci per host. Quindi passiamo in realtà come misura l'host. Quindi il primo livello gerarchico è l'host. Quindi la tabella che ne so era sberro numero 7, numero 5, numero 12, numero 6. Ognuno ha dato un livello. Quindi abbiamo chiamato myhost se non sbaglio. Vediamo un po' se vediamo. Sì, myhost lo chiamiamo io. Poi quello che si può fare è aggiungere un tag, punto tag, quindi point.tag. E i tag possono essere coppie chiave valore. Quindi in questo caso potremmo dire tag location e il valore potrebbe essere ultimo. Poi campo. Andiamo ad aggiungere un campo, quindi punto field. Temperatura. E questa volta gli passiamo temp come valore. Sì, ma dove mi sono? Sì. Sì. È un tavolo. Quindi il mio aiotto è il livello principale. Sì. Il livello secondario è preso sui campi di fronte allo stesso. Esatto. Poi facciamo un altro punto, poi, dove, e lo rifacciamo uguale se non per il tag, che non per il campo, scusate, che non sarà temperatura, ma sarà mobilità. Quindi point. Quindi point. Myhost.time. Location. Ci mettiamo sempre un vino. Field. Ci mettiamo sempre un vino. Field. Ci mettiamo. Umidità. Visto che è un'altra. E' un'altra. E' un'altra. E' un'altra. E' un'altra. Umidità. Visto che ho messo in italiano. Qui allora. Umidità. Umidità. Umidità. Ok. Adesso dobbiamo scrivere, però. Quello non l'abbiamo fatto. Giustamente, mi suggeriva qua di fare anche una spanta. che è una stampa. E' una stampa che rivediamo in camonica quello che succede. Quindi prima di fare i punti, facciamo una stampo su. di punti, facciamo un'altra. E' un'altra. E' un'altra. E' un'altra. E' un'altra. E' un'altra. di punti. Quindi facciamo la print. E' un'altra. E' un'altra. E' un'altra. che scriviamo. Tempio di natura. Due punti virgola. Facciamo un finale concatenato con il Fp. di tempo. Bene. Bene. Prima di. Prima di. Prima di. Prima di. Prima di. Prima di. Prima di. Prima di. Prima di. Prima di. Prima di. Prima di. users. Grazie a tutti.OOOO due secondi ok a questo punto abbiamo fatto la stanza dobbiamo salvare quindi grazie i uniti vado come giusto vado a scrivere quindi la stessa cosa ora vado a scrivere sul di bing bravissimo qua leggo temperatura umidità tutto questo lo mettiamo in un superlutto altrimenti quello che facciamo ci scriviamo una volta sola facciamo pausa e dopo possiamo vedere un po' di dati quindi loop qua dentro tutta questa roba qua compreso la scrittura per scrivere si usa bright api bright api punto bright la prima cosa il bucket il bucket non l'abbiamo ancora dichiarato il bucket è un argomento nella nostra bright api quindi bucket prende my my e poi ci servono i punti sotto forma di record e qui facciamo un array di punti quindi point 1 virgola point 2 ci siamo il superlutto non è fatto con loro si sapeva poi un'invocazione client close ma facciamo il decimo non superlutto che non terminerò mai quindi non faremo mai la client close ci sarebbe anche la possibilità di leggere i risultati della nostra bright se la bright è un'altra buona fine eccetera possiamo ritornare il valore e confrontare scusate la slip bravo facciamo una slip mettiamo di 5 secondi diamogli un po' di tempo visto che adesso vediamo cosa ci dice facciamo un save proviamo a fare un run non modul in influx db client allora scusate in flux eppure from influx db client che non abbia installato proviamo proviamo vediamo come si chiama di brin installare si posso l'ho installato vero l'hai trovato l'hai trovato si l'ho installato l'ho installato l'ho installato db di buf install Earlier come si chiama il paper? il paper del part in flux di B ma ultra lupato senso a un nodo featuring a virtual and driver by allora mi sa che è un po' vecchio ma anche questo edu sicuro? io sto installando voi avete finito? allora guardiamo prima finiamo di installare non so che timeout non ci piace ah vedi allora dai e tante cose sta allora ma ma senza funziona e mi sono più più 3? a mi funziona a me sta andando non ritorno eccezioni quindi probabilmente sta anche anche scrivendo ma io ho fatto pip e basta pip install e ha funzionato ma è solo un warning guarda che sai la versione 22.7 ma c'è anche la sta funzionando adesso bisogna vedere che cosa ha prodotto il nostro DB f expansioneੰ hat servicito prima se lo rimetto se lo rimetto bene su esistenti cheru che cosa è quindiieth ma si tutto stessaving what ecco guarda pip install inclusivit è quello che gli mancava vi da ancora un time out provo a controllare le url che tu l'abbia messo bene il tuo che non aveva i copi incollato direi che non dalle problemi anche il bucket che si è scritto bene perché ti rifiuta la connessione se dai un bucket non esistente esercitazioni tutto minuscolo due punti 80-87 io adesso condivido un attimo vedo che stanno arrivando la raspberry 7 sta scrivendo che la mia anche la 8 ce l'abbiamo che sta scrivendo si chiama rapberry però proprio lo stesso se abbiamo anche umidità io ti ho messo l'accento forn倉 Ce l'hai? Eh sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Io non l'ho visto, ma l'ho preso. Sì. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. Sì, dopo. I dati di numero 8 si vedono, ma solo la temperatura. Ci dice un compagno di corso che è Tambone. No, in realtà, se filtro per rasberry numero 8 vedo la temperatura, mi dice, vedo due campi di field adesso in condivido facciamo da capo se andiamo da explore e un po facciamo l'aggiornamento esercitazioni e adesso vedo numero 8 numero 4 numero 7 era per l'arberia numero 8 per la vecchia che però adesso io ne vedo tre quindi la quattro la 7 e la 8 a quel punto vedi tutte le curve di tutte le quattro temperature umidità location urbino perché poi è carino filtrare ad esempio chi selezioni tutte le raspberry e dici guardo la temperatura sub it vedete tra vite tre livelli di temperatura diverso certo c'è ci sono le query che tu puoi fare così come facciamo le bright anche da python c'è la read no dai ditemi che errore però è un segreto bene allora adesso le lasciamo scrivere andiamo a prendere un caffè facciamo una pausa di 10 minuti dopo quando torniamo analizziamo un po i dati allora io metto in pausa la registrazione se ce la faccio spostare questo qui ok metto in pausa ok ok Grazie. Grazie. Grazie. Grazie. Grazie. Grazie. Grazie. Grazie. Grazie. Grazie. Grazie. Grazie. Grazie. Allora, come vedete sta funzionando. Quindi i dati stanno arrivando. Quello che vediamo intanto è che ci sono delle differenze che sono non abissali, perché qui la scala chiaramente è un po' zoom, ma vediamo che si va dai 33,9 ai 34,9. 35,7. Ecco, 35,7 è il valore più alto del numero 7, che è la mia, ma la mia probabilmente la CPU sta facendo un po' di quasi in più perché è collegata in WNC Viewer e sta anche trasmettendo lo schermo, quindi probabilmente ha un'interferenza maggiore dovuta alla CPU che scalda. ovviamente le molte sono un pochino più allineate anche se hanno giustamente un po' di varianza intorno all'altro. Però ecco, quello che voglio far notare è che grazie a questo sistema di tag è facilissimo. se ho selezionato le sorgenti, in questo caso sono le misure che abbiamo chiamato come il numero, come il nome del sensore, la numero 11, la 4, la 7, la 8, se le seleziono tutte, poi vado a scegliere ad esempio temperatura, essendo la Submit mi fa vedere tutte le temperature. e in più la location, adesso sono tutte urbino, ma pensate se location aveste una che ne so soggiorno, un'altra camera da letto, o meglio, avete più sensore in camera da letto, più sensore in soggiorno, io voglio vedere solamente l'andamento di una cosa in soggiorno, andavo evidenziata come location solamente soggiorno e a quel punto avrei filtrato tutto per la location. vediamo l'umidità, adesso abbiamo gli umiditi, umidità e umidità, quindi dobbiamo cliccarli tutti. facciamo il Submit, ecco nell'ultima ora, l'umidità varia un po' meno, una varianza un pochino più bassa, perché passiamo da 29,4 a 31,5. non è poi così alta. e poi, come vi ho fatto vedere l'altra volta, siamo in grado di fare diverse elaborazioni, perché adesso in automatico abbiamo fatto ad esempio l'ultima ora con la funzione di aggregazione, e la funzione di aggregazione è la media, min, in automatico. già se scegliete last, la funzione di aggregazione praticamente vi ritorna l'ultimo punto, ogni ad esempio 5 minuti, piuttosto che la media. però abbiamo visto anche che con lo script editor è facile andare ad aggiungere una qualsiasi funzione, anche ad esempio in un'interpolazione esponenziale, abbiamo visto la volta scorsa, è davvero semplice. e guardate quante funzioni ci sono a disposizione qua giù per fare elaborazione. bene, adesso quello che vi volevo far vedere però nell'ultima parte di questa esercitazione è che, torniamo nel codice della nostra Raspberry, questo lo lasciamo adesso così un attimo, quindi ritorno alla vista iniziale. ok, togliamo e vado a ricondividere la nostra Raspberry che sta lavorando. abbiamo fatto una architettura super loop, quindi diciamo il nostro task è sempre in esercizio. se avete a che fare con un edge device molto semplice, allora questa è la via giusta, abbiamo già parlato di super loop, eccetera. ma sicuramente in un sistema come Raspberry Pi non è la cosa migliore da fare questa, perché tenere il nostro task in loop in continuazione, forse ci sono soluzioni migliori. soluzioni migliori dettate dal fatto che qui su abbiamo un sistema operativo completo. ad esempio abbiamo Linux e Linux sappiamo che è in grado di schedulare un task periodicamente, quindi la cosa che ci conviene fare è un task che abbia un inizio ed una fine, così magari ogni volta che il task riparte ritenta la connessione, quindi ammettiamo che per un certo periodo di tempo la rete sia giù, è vero che perdiamo i dati in quel momento, ma quando la rete torna il nostro task dovrà funzionare. in questo caso avendo fatto la connessione all'inizio facciamo in un super loop, se la connessione non è restaurata in maniera corretta, il super loop sarà sempre in errore. Visto che abbiamo a che fare con un sistema operativo evoluto, questa cosa ci possiamo permettere di farla. Come la facciamo? Ora stoppiamo questo task che è il super loop, togliamo il super loop, quindi togliamo proprio il nostro super loop come abbiamo messo all'inizio, ricordandoci che possiamo fare questa cosa perché siamo in un sistema operativo evoluto, perché la nostra Raspberry come vi dicevo ospita proprio il vino. togliamo anche la slip perché, visto che saremo il sistema task che parte e termina, non ha senso mettere una slip, e andiamo a completare il nostro codice invece con quello che vi dicevo essere anche la chiusura. quindi, qua abbiamo creato il nostro client all'incima, dopo aver fatto la write andiamo a chiudere, chiudo la connessione e quindi vado a fare client punto dunque è close. quindi il nostro task parte, tenta la connessione, legge senza app, scrive e poi termina chiudendo la connessione. ok? vediamo se funziona. è partito ed è terminato. bene, visto che stiamo collezionando valori come temperatura, umidità, che non hanno una variabilità nel tempo così elevata, ad esempio ci basterebbe campionare una volta al minuto, sarebbe una cosa già intelligente. conoscete in linux un sistema che vi permette di eseguire un task periodicamente con dei tempi noti? il cron tab ad esempio, no? il cron è la cosa migliore da usare in questo caso. quindi adesso noi il task che l'abbiamo salvato, nel mio caso su home, pi, desktop, esempi, esempio raspberry eccetera, vado a prendermi questo percorso assoluto. scusa, guardiamolo subito, andiamo in fretta. ecco qua. questo è il cross. abbiamo tolto la slip, abbiamo tolto super lungo, e adesso proviamo invece a mettere un cron tab e ci faccia questa cosa. quindi prendiamo le scele. allora intanto il mio percorso assoluto è... si serve ancora vedere il codice, scusa. no, dov'è che ero messo? adesso, dopo esercizi. no, semplicemente vado a cercare esempi. e ad esempio ancora. l'ho chiamato. prova include b. ce l'abbiamo qua. ok, perché mi servirà tutta questa stringa che vado a copiare. prendo un'altra shell. così. facciamo. e non vuoi. ok. cosa facciamo adesso? lanciamo. front tab. ok, se non sbaglio. se non sbaglio. troppo ci sono. però molto un po' se lo gioco, gli asterischi, per il tempo, le... sì, è una cosa un po' strana, però... vedete? comunque c'è nel... nel suo elfo, in qualche modo, c'è minuti, ore... allora, in realtà minuti vuol dire a quale minuto, di quale ora, di quale giorno, eseguire un comando. quindi io potrei anche voler eseguire un comando al minuto cinque di ogni ora, di ogni giorno, eccetera. quindi se un minuti, dico uno, non vuol dire che lo fa ogni minuto, mi dice che lo fa al minuto uno, di ogni ora, di ogni giorno, eccetera. quindi per dirgli tutti i minuti, è molto semplice, perché io se dico asterisco è il jolly, quindi vuol dire sempre minuti a qualsiasi minuto, ora a qualsiasi minuto, ora, domenica, giorno, qualsiasi giorno, quindi se metto tutti i asterischi, risolvo... esatto un cosa lo vuoi editare e scegli il tuo... io uso... invece Nando non mi fico per niente e poi mi fico per niente e ti fico per niente e ti fico per niente e ti fico per niente e ti fico per niente e ti fico per niente e ti fico per niente quindi se vogliamo eseguire una cosa ogni minuto, è molto semplice, perché basta che riempiamo tutti i comandi di asterischi quindi la sua granularità è il minuto quindi come vedete io ho messo 5 asterischi quindi ad ogni minuto, ad ogni ora, di ogni giorno, di ogni mese, di ogni anno e poi mi serve il comando però gli devo dare il comando da eseguire quindi il comando lo possiamo specificare con... noi conosciamo il nostro file quindi possiamo scrivere Python chiediamo penso a Python 3 no basta mettere il percorso poi assoluto chiaramente del file che io avevo... dovrebbe essere nel pass, vero? ho messo un po' piatto ma non me lo faccio ecco io mettiamo tutto il percorso home, pi, desktop, esempio, raspberry, esempio, raspberry pi slash il file era prova in flux db prova in flux db punto pi fatto bene? prova in flux db punto pi ecco questo vuol dire che ogni minuto, di ogni ora, di ogni giorno, di ogni anno, di ogni mese, eccetera viene eseguito questo task il task parte, fa il collegamento, legge i sensori e poi termina se avete un sistema operativo evoluto come loop possiamo evitarci quindi il super loop se ci basta come tempo di campionamento un minuto quindi adesso chiudiamo il file io ho usato il di a e quindi faccio due punti vai tu e ci siamo al prossimo minuto e quindi non non non non non non non non non non non non non non non non non non non non non non non non questo praticamente così avete configurato la nostra nasberry pi e questa ora durante ogni minuto fare questa cosa se la spegnete e le riaccendete e non disinstallate il cronta il cron tab, questa rimane sempre un task che verrà eseguito. Esatto, l'ha reeseguito di nuovo da me. Ok dice 90 install. Giusto, esatto, esatto. Quindi bisognerebbe... Sì, esatto, perché abbiamo la print, quindi... Andiamo a vedere se stanno arrivando i dati qua sopra. Adesso prima arrivavano ogni 5 secondi, adesso saranno ridotte le occorrenze. Temperatura. L'ultima ora. Posso anche vedere il raw data. Nella console... Adesso lo scusate, non lo sto trasmettendo. Nuova condivisione. Ecco, nella console, vedete qua c'è questo piccolo switch, view raw data, così vediamo il grafico. Invece se mettete su view raw data, vedete proprio i dati uno per uno, a che tempo sono arrivati. Allora io sono una nuova. Noi, io sono un nuova. Grazie. Grazie. Grazie. Grazie. Grazie. Grazie. Grazie. Se vedete adesso sono effettivamente i punti sono uno al minuto. Ce l'abbiamo alle 10 e 45, 10 e 46, 10 e 47, 10 e 48. Vedete? Adesso i punti sono effettivamente uno al minuto. Però vi dicevo se avete a che fare con le radieste che vadano lentamente, soprattutto avete a che fare con il sistema operativo evoluto, questo è una via testa. Prego Paolo. E ora? Sì, adesso chiudiamo. Mancano ancora la decina di minuti. Recuperiamo tutta l'ambara d'anno. Quante ore fate? Uno bozzo? Ah, perché da noi. Ah, vedi? Non sapevo che è stato anche il pomeriggio. Comunque adesso abbiamo finito, non ho altro da farvi vedere se non appunto che tutto funzioni. No, adesso lo cancelliamo, magari, altrimenti queste raspberry continuano a scrivere. Sì. Quindi facciamo quello di prima. Rientriamo dentro il file di prima. Rientriamo dentro il file di prima. In realtà è comodo. Il problema è che c'è risultato il minuto. Sì. Sì. Non scende sotto il minuto. Però, come dicevo prima, se dobbiamo lavorare con il sistema campionale a temperatura, un minuto è anche troppo alla fine. La temperatura ogni minuto in una giornata sono tanti punti, eh. Soprattutto non cambia velocemente. Quindi, temperatura, umidità, cioè i parametri ambientali spesso si cambiano solo in 10 minuti. Bene. Adesso vi posso che anzioniamo la riga. Sì. Pensate la riga salvate e il Contab, praticamente, aspetterà di eseguire quel dato. Poi ci mettessi un commentino. Certo. Certo. Certo. Certo. Certo. Però capite che se avete un Raspberry Pi a questo punto, a casa per fare un monitoraggio di qualche grandezza, lo sparate su in QVB con un cron così, in quattro righe di codice, insomma, l'avete fatto. Una cosa divertente, ecco. Bene. Quindi possiamo spegnere tutto. Io blocco la registrazione. Invece giovedì facciamo teoria. Sì. Sì. Interrompi la registrazione. Interrompi la registrazione. Grazie. Grazie. Grazie. Grazie. Grazie.