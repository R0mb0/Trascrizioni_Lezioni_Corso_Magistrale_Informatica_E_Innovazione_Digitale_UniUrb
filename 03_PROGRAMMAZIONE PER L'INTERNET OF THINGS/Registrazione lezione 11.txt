cosa facciamo oggi oggi facciamo una situazione per ripai come vedete sul banco usiamo lo scelte del sensato non avremo potuto usare anche quello prodotto ma in mente perché faremo di nuovo l'eventazione in cui campioneremo qualche valore numerico dai sensori e di nuovo lo spediremo su influx db che il nostro server un giorno per mantenere le serie temporali solo che l'altra volta abbiamo fatto l'esercitazione dove ci siamo avvalsi come vi ricordate delle libri delle ip ai python di influx db che ci permettono scrivendo codice direttamente in python di autenticarci usando il tuo che non tanto lo url e inviare informazioni al server abbiamo visto quanto sia intuitivo effettivamente farlo attraverso queste ipi però questa non è la via principale diciamo di usare influx db quando l'abbiamo studiato nella teoria vi ho detto che influx db ha una pletora di plugin che si chiamano telegraph che praticamente sono disponibili per tutte le piattaforme questo plugin telegraph prescinde dal linguaggio di programmazione quindi non è necessario usare l'api in python in questo caso perché telegraph telegraph è un a tutti gli effetti un plugin che noi dobbiamo semplicemente installare scaricare e va configurato cioè ha un suo file di configurazione che è un file testuale human readable dove dovremmo dire appunto alcune cose e specificare come questo plugin telegraph deve contattare il server quale informazioni deve catturare in input quale la sintassi per spedirlo e magari fare anche del processo locale telegraph è un plugin molto potente e come avete visto su influx db esiste una documentazione ampia e variegata l'unica cosa che il nostro telegraph che dobbiamo fare per poter far funzionare il nostro telegraph è installare la versione eseguibile per la vostra piattaforma quindi se siete su desktop sistema operativo windows avete la sua versione se siete operativo linux la sua versione raspberry pi con la debian con la nostra cosa ha la sua versione una volta installato l'unica cosa che dobbiamo fare configurarlo per farlo funzionare bene ma telegraph vi dicevo ha una quantità di plugin e di possibilità elevatissime nel nostro caso useremo una specifica molto semplice che è quella di raccogliere l'input dallo standard input di un qualsiasi programma quindi vedremo che con telegraph se avremo un qualsiasi processo che genera uno standard output telegraph sarà in grado di raccoglierlo fare un parsing dell'output tradurre questo output in tag e spedirlo su influx db questo vuol dire che ciò che vedremo oggi funzionerebbe con qualsiasi processo in grado di generare informazioni noi per processo in grado di generare informazioni faremo un piccolo un piccolo script python che produrrà andando a leggere su sensat e produrrà le sue informazioni numeriche relative ai sensori a disposizione stampando in una standard output telegraph catturerà questo standard output farà il parser il parsing produrrà i tag opportuni e li spedirà su influx db e e questa è l'idea quindi anche dal terminale volendo certo niccolò telegraph dicevo a delle punti una una valanga di possibilità davvero enorme adesso andiamo a vedere come il tutto si potrà gestire ok allora la prima cosa che vi faccio vedere è questa è condivido un'altra cosa che lo schermo perché avrete notato sulla piattaforma blending ieri ho caricato un po di ford informazioni che ci serviranno oggi per questa esercitazione sulla piattaforma blend in in cima ho caricato una diretta esercitazioni influx db più telegraph del 9 11 è proprio oggi andiamo lì dentro e ci sono un po di informazioni perché non dobbiamo non vogliamo creare il file di configurazione di telegraph da zero comunque abbastanza macchinoso potremmo prendere questo ma la prima cosa andiamo a vedere istruzioni telegraph su raspberry pi perché le raspberry pi che avete di fronte non sono state diciamo così inizializzate con installando telegraph lo faremo insieme non siamo diciamo non ci siamo messi a eseguire su queste la parte di installazione ma lo faremo insieme quindi ci conviene aprire questo file direttamente dalla raspberry pi così possiamo fare proprio incolla delle righe che ci mancano quindi adesso torno a condividere la raspberry pi condivido la sua interfaccia e da qua vado a navigare su blended fate voi la cosa così diamo la possibilità di fare copia incolla diretto delle stringhe da questo file di istruzioni e poi lo vedremo insieme quindi blended.uniuro.it l'ho scritto una metà ah io non sono connesso con l'ambiente andiamo un po' se io mi dovrò autenticare giusto ah ma www.unit.org.it Anche voi quindi fate il login. Eccoci qua. Vado su IoT. Apriamo la diretta di esercitazione in flux. Ah, ho lasciato una N, i flux. Sì, non lo modificano. Apriamo le istruzioni Telegraph su Raspberry Pi, che è questo file di testo, e lo otteniamo da una parte, perché dobbiamo iniziare a configurare appunto la Raspberry in questo momento. Bene. Ce l'avete tutti? Chiaramente. Siamo. Siamo sotto. Come? Sì, ho visto anche da me. Sì, poi abbiamo giustamente questa sensazione che attendere di fronte a un computer sembra un anno, no? Una vita. Sì, ho visto che c'è un'altra cosa. Quando ti vieni in un'altra cosa, non sono secondi. Non siamo più in grado di portare tutto quel tempo. Ok, allora, io sono su Raspberry Pi 07, che sono, voi ci siete. Apriamo una shell e vedete, il primo capitolo di questo file .txt che ho caricato è installazione. serve questa parte per poter installare Telegraph, che è questo plugin, un plugin proprio di InfluDB. Quindi vedete, ci sono tre azioni da fare sulla linea di comando che sono orientate a inserire le chiavi delle repository di InfluDB, aggiungere repository alla lista dei repository sorgenti e poi finalmente installarlo con sudo apt-get install. Altrimenti non è nel repository standard della Debian, quindi non abbiamo la possibilità di fare questo. Quindi prendiamo la prima linea, fino al meno, la copiamo e la spariamo sulla nostra shell. Vediamo invio. Allora, c'è questo impossibile risolvere l'host, questo è un problema di configurazione delle nostre Raspberry, ma non è un errore. Vedete, alla fine ha scritto ok. Ok è quello che ci piace. Purtroppo ogni volta che lanciamo un comando tramite sudo, la configurazione che abbiamo fatto, che è ancora in temporanea di queste Raspberry, dice impossibile risolvere l'host, ma già con Paolo abbiamo capito qual è il problema e quindi è risolvibile facilmente. Quindi evitiamo tranquillamente questo messaggio, che non è un vero messaggio di errore. Siete riusciti a portare a termine la prima linea? Proviamo la seconda. che è una linea composta, vedete c'è una pipe a un certo punto come nella prima. Incolla, invio, deb, https, busker, stable, l'ha messo. Adesso facciamo la terza linea, che è sudo apt-get install telegram. io questo l'ho trovato nella documentazione di InpluDB, ho visto che facendo le prove su un'altra Raspberry funzionava. grazie. Grazie. No, no, mi sa che devo aggiungere perché ti metti in su, sul punto di vista. Eh sì. Se non hai la chiave per forza, perché se non c'è anche la chiave, non te lo posso fare. Esatto, se non hai la chiave autenticata, ho visto che non ti fa più installare, ti dice, è stato disabilitato. Ah, da me dice, è impossibile trovare il pacchetto telegram, non siamo proprio contenti, anche da voi fa questa cosa. Date, esatto. Date, giusto. Sudo apt-get update, e poi dovremo fare install. Mi manca un video. Dopo la giorno, questo. Sì, ma, perché l'ho fatto qualche giorno fa, poi ieri mi sono cercato di ricordarmi, passi che ne ho fatto, ma me ne è saltato un. Sì, è un micro. E più commerciale. Allora, nella IoT un po' bisogna smanentare, tanto tu. Paolo. Paolo. Vediamo adesso se va. Ok, adesso ce la fai, ovviamente dopo l'update, ho fatto install, telegram sta caricando il pacchetto. Quindi, dopo aver aggiunto le chiavi, ci va su da apt-get update, e poi su da apt-get install. vediamo del suo tempo. Vediamo. Sono una trentina di megabyte. estrazione. Come si chiama? Sì. cominci a andare più spedita, mi sa. Quale l'hai già provata ad usare? il tuo? Ah, vedi? Ah, beh, ma allora dai, c'hai un bel sacchettino della spesa. Ah, già, vi hai comprato il pacchetto completo. fantastico. Sì. Fantastico. Quanto li fai al chilo? Ok. Da me è andato su. È arrivato in fondo. Dopo update, rifate su da apt-get install, telegraph, e dopo installerà il nostro telegraph. Adesso, passiamo invece, prima di fare la configurazione, e andiamo a creare invece un task, questa volta scritto in Python, che ci produrrà delle informazioni a partire dalla nostra sense app. Ok? Forse ce l'avevamo anche da qualche parte. Quindi, lanciamo il nostro Tony Python id. Perché ci serve, come vi dicevo, un processo autonomo che legga le informazioni, ad esempio, da sensore e le stampi semplicemente nello standard output. Allora, questo così era l'ultima cosa che facemmo. Facciamo ne uno nuovo. Chiamiamolo semplicemente sense.python.py Quindi, lo lasciamo tranquillamente su esempi raspberry, io lo chiamerei sense.py ok, andiamo a fare l'import, quindi from sense underscore at importiamo test. Questo non sarà in super loop questo task, perché semplicemente partirà, leggerà i sensori e si spegnerà il task. Non dovrà essere in super loop, perché sarà telegraph che lo invocherà secondo la configurazione che voi gli passerete. Gli diciamo, lo devi invocare ogni 5 secondi, ogni 10 secondi, eccetera. Quindi, il task deve terminare. Ok? Quindi non abbiamo bisogno di importare la nostra libreria slip, ad esempio. Bene, quindi passiamo subito a creare il nostro task dove creo listanza di sense at sense prende sense at mi sembra che il costruttore non abbia nulla. Esatto. Poi invoco clear per inizializzare la piattaforma e pulire il display. Questo almeno è ciò che vanno nella documentazione di sense at quindi sense punto clear Ora vado a leggere leggo temperatura e umidità quindi temp prende sense punto get temperature mi sembra eh ma dove è chiaro dall'altro file get underscore temperature scusate get underscore temperature humidity prende sense punto get underscore humidity quindi ora l'unica cosa che ci serve fare è stampare nello standard output questo valore quindi stampo nello std out i valori di tempo e umidità perché poi sarà telegraph che li raccoglierà quindi noi creiamo un task che a tutti gli effetti stampa nella standard output stampiamo su una stessa linea altrimenti appunto dovremmo specificare a telegraph di leggere su più linee ma così diventa più semplice quindi facciamo print possiamo mettere semplicemente anche dei tag quindi temp due punti per cento stampiamo con la sintassi questa volta per cento come si fa appunto 2f se non sbaglio si accorciamo a due cifre temp e poi facciamo spazio umiditi due punte per cento facciamo sempre 2f così accorciamo a due cifre per cento eh temp humidity sembra di aver fatto bene ok facciamo un save e proviamo a vedere intanto come possiamo eseguirlo come task indipendente vediamo cosa dice temp 3306 humidity 33.58 siamo quasi simili temperatura e umidità da voi cosa vi ritorna? 30 30 30 va bene si la mia raspberry è sempre la più calda perché sto facendo un po' di divisione va bene e questo task è banale no? parte legge e scrive con questa sintassi tempo due punti 33.02 humidity eccetera bene adesso cosa ci serve fare? ci serve configurare però la nostra ehm il nostro telegraph telegraph si configura attraverso un file .conf che è un file di testo che ha la sua sintassi io questo file ve l'ho già predisposto adesso lo andiamo a scaricare da Moodle e lo copiamo nella nella nostra directory ad esempio nella home di raspberry pi ok quindi torniamo sul nostro blended dentro la directory esercitazione in flu di B vedete che c'è un secondo file diciamo un attimo auto quindi non risponde più il browser purtroppo i siti di oggi sono molto posanti da questa occupazione della RAM sicuramente ha swappato di brutto la mia raspberry ok sono riuscito comunque a scaricare telegraph.conf me l'ha messo nella cartella download io lo vado a togliere da qui faccio puntaglia e home adesso l'ho messo nella home perché così è facilmente raggiungibile da linea di comando siete riusciti anche voi a scaricarlo? bene allora adesso andiamo di nuovo nella shell di prima dove siamo siamo ecco nella home e abbiamo telegraph.com lo apriamo con nano visto che l'altra volta ci è piaciuto e si apre questo file che adesso andiamo un po' a vedere insieme prima magari di fare delle modifiche metterci delle metterci mano io sono nato cresciuto con guai mi trovo meglio che io mi trovo molto bene però devo dire la verità quello su raspberry pi ho notato che c'è qualche barco e quindi anche io su raspberry pi uso nano che mi piace un po' di meno però lo faccio insomma volentieri allora vabbè questo è un file di telegraph configurazione di telegraph che come vedete è stato fornito direttamente da include b e come funziona allora le praticamente le sezioni sono identificate da questi parole chiave dentro parentesi quadra quindi la prima sezione la prima sezione in cui definisco i tag globali cosa sono i tag globali posso andare a dire ad esempio catturare lo user come variabile d'ambiente che sta eseguendo su questa raspberry e posso far sì che quando spedisco i dati su include b ci ha sempre ad esempio aggiunto un tag user uguale l'utente che l'ha generato come faccio vabbè semplicemente se io decommentassi user uguale dollaro user tutti i dati che io sparo verso in fluidi avranno anche un tag vi ricordate che in fluidi ha la possibilità di aggiungere tag no alle misure avranno sempre un tag utente in questo caso file perché l'utente di login qua sopra è file lo lasciamo stare non ci serve questo tag quindi qua ci sono tag generali c'è il tag dove puoi andare ad aggiungere appunto l'utente l'host se vuoi cioè il nome della macchina sono un po' di informazioni relative a queste informazioni qua poi invece bisogna definire quantomeno un agente l'agente è proprio il task telegraph che eseguirà e che sarà in grado di collezionare informazioni e spedire su in fluidi allora l'agente quindi come vedete è già decommentato e ci dice qual è il default data collection interval tutti gli input che poi li diremo di sotto nel nostro caso sono collezionati ogni 10s ogni 10 secondi quindi questo vuol dire telegraph ogni 10 secondi eseguirà l'agente e l'agente andrà a collezionare i dati e li spedirà sul fluidi quindi qua possiamo mettere tranquillamente 20 quello che volete per avere una frequenza di campionamento ma possiamo mettere per non appesantire troppo 30 secondi poi ci abbiamo altre informazioni tipo la patch size queste le lasciamo di default buffer limit con lesion jitter sono tutte informazioni flash jitter che servono al telegraph per capire appunto cosa fare e come farlo l'agente nella sua periodicità poi ci abbiamo precision anche qua telegraph possiamo andare a scegliere quale precisione vogliamo nella tempistica di esecuzione se il superman ha dato 30 secondi e mettiamo la precisione al secondo diciamo che lui può lavorare con la precisione di un secondo ma se vogliamo essere precisissimi possiamo forzarlo al millisecondo se per noi è importante appunto la precisione il timing di esecuzione lasciamolo pure al secondo lasciamo anche debug true in modo tale che in questa prima fase sarà verboso e quindi ogni volta che il nostro telegraph eseguirà ci dirà qualcosa dove salvare lasciamo file e se in seguito log file è uguale a vuoto vuol dire che stampa sullo standard error come vedrete scritto da qualche parte vedete ecco the empty string ha una riferita su standard error quindi se sopra lasciamo file sotto lasciamo log file vuoto stampiamo sullo standard error se qui potremmo anche mettere invece un nostro file dove andremo a collezionare tutto l'output di di raspberry file ecco anche qui hostname se hostname è lasciato vuoto allora viene usato l'hostname catturato dal sistema operativo l'hostname diventerà un tag che potrà essere spedito appunto all'include e qua mi dice vuoi ometterlo oppure no lo hostname in questo caso è false quindi vuol dire che lo hostname non è omesso ma viene inviato a include questa prima fase quindi è tutto ciò che va a configurare l'agente vedete che la sezione di include b parte da agent un agente almeno un agente serve perché l'agente avete capito specifica con che frequenza include telegraph eseguirà con che frequenza farà le cose che gli spieghiamo sotto esatto si li posso numerare così e partono anche in parallelo si poi ci abbiamo l'altra sezione fondamentale è l'output plugin cioè l'output dove lo mandiamo anche qui l'output plugin ce ne sono vari tipi io nel file di configurazione ho tolto tutto e ho lasciato solo come output plugin include b versione 2 nel senso che il nostro output sarà verso un server include b versione 2 perché c'è anche il plugin per le versioni vecchie quindi abbiamo già preconfigurato l'indirizzo ip del server con la porta 80 36 ho già configurato il token che è sempre lo stesso per la nostra piattaforma l'organizzazione un iurb il bucket vedete questi sono tutti i tag obbligatori una volta che voi specificate come output plugin in flugdb versione 2 questi sono i tag obbligatori serve lo url serve il token serve l'organizzazione serve il bucket che da noi si chiama esercitazioni che è quello dell'altra volta il bucket di influgdb che abbiamo visto l'altra volta e poi diciamo non ho configurato un proxy non ho configurato un timeout diciamo lasciamo tutto il default si possono usare lo potremo salvare da qualche parte si possono usare anche la db vedete si possono scegliere un proxy il nome di questa htp user agent abbiamo messo telegraph e finisce qua si può prevedere la compressione dei dati così viaggiano meno informazioni e via dicendo bene l'output db quindi l'abbiamo già configurato l'output db ora dobbiamo ragionare sull'input invece l'output plugin sull'input plugin l'input plugin è un qualcosa che ci permette di raccogliere informazioni che poi verranno spedite sull'output plugin ce ne sono di vari tipi allora qui c'è quello standard che ho lasciato commentato l'input cpu l'input cpu è commentato quindi non è attivo in questo momento potremmo decommentarlo e l'input cpu andrà a leggere informazioni di percentuale occupazione cpu total cpu eccetera dal sistema operativo e le spedirà anche queste come informazioni sul nostro input db ma non vogliamo fare questo vogliamo andare a vedere un input exact l'input exact è un tipo di plugin appunto che come input riceve le informazioni di un'esecuzione di un qualsiasi programma che sputa le informazioni sullo standard output bene qual è il comando bene il comando dovrà eseguire il nostro file che abbiamo predisposto che si chiamava sense quindi io qui del comando ho messo python3 home py adesso questo non va più bene perché era un esempio che avevo fatto io perché il nostro file si chiama su home py diciamo andiamo a vedere come si trova perché mi sembra si chiami desktop esempio raspberry esatto questo percorso qua dobbiamo scrivere esempio raspberry due volte sense punto py quindi il percorso assoluto è py poi desktop sì slash esempi per esempio raspberry slash nuovi esempi raspberry slash l'abbiamo chiamato sense con l'S maiuscola punto py quindi questo specifica questa sintassi semplicemente va a specificare qual è il comando da eseguire ogni x tempo dall'agente il time out è 5 secondi quindi telegraph si lamenterà se il programma non termina entro 5 secondi se il vostro task dovesse durare molto qui potete aumentare prima di farlo chiaramente lamentare possiamo aggiungere vedete un suffisso che diventa essenzialmente un suffisso da mettere ad ogni tag che specificheremo in seguito se abilitiamo suffisso che lasciamo stare un attimo e poi bisogna chiedere bisogna dire a questo input exec a questo plugin cosa si aspetta qual è la sintassi che si aspetta nello standard output prodotta dal task che abbiamo identificato sopra ci sono varie tipologie di data format che specificano in qualche modo la sintassi di cui fare il parsing e non so se la conoscete la data format di tipo groc avete mai scelto parlare? ce ne sono un numero diciamo così ampio se andate a cercare sulla documentazione di influxdb e andate a cercare la data format è compatibile con un numero davvero ampio di tipologie di sintassi e quello che mi sembrava più semplice è proprio la groc quindi lasciamola in questo modo semplicemente andiamo a definire un parser che andrà a fare una ricerca nella stringa il groc parser ecco qui adesso noi andiamo a vedere come il nostro task produce l'output così ci facciamo subito un'idea di come possiamo parsarlo vedete allora il nostro task produce l'output andando a dire tempo due punti e poi un numero bene quindi tempo con la T maiuscola il primo pattern da cercare sarà tempo due punti e poi al posto di percento lui cerca appunto quello che viene specificato dopo nelle parentesi graffe cosa cerca? cerca un number di che tipo float come lo taggo questo valore tempo è come taggarlo quando lo mando ai flui di B lo posso qui quindi lo scelgo io posso mettere tempo posso mettere temperature mi chiamano per esterno poi cosa cerca? cpu temp questo lo cancelliamo perché in realtà nell'esempio attuale c'è humidity quindi dobbiamo mettere humidity humidity perché noi nel nostro sense abbiamo fatto sì che stampasse humidity due punti quindi la seconda cosa che cerca è humidity due punti poi un valore numerico quindi un number di tipo float che noi taggheremo con humidity minuscolo e l'ultimo lux non ce l'abbiamo in questo esercizio perché avevo fatto una prova con l'altro shield che aveva anche la luminosità quindi cancelliamo tutto fino alle doppie virgolette quindi il pattern che noi passiamo al parser drop è temp due punti un numero spazio humidity due punti un numero il numero definiamo che in entrambi i casi è un float se lo trova lo taggerà su influ di b con il primo a temperatura e il secondo humidity quindi questo è l'unico punto in cui ci deve essere matching tra lo standard output prodotto da sense che abbiamo scritto in python ma poteva essere scritto in qualsiasi linguaggio come avete capito e appunto il parser drop bene cosa abbiamo aggiunto poi volutamente bypassato name underscore override name underscore override lo so che è un po' bruttino come tag ma in realtà definisce il nome della misura vi ricordate che in flutti b lavora con le misure measurement questa misura è una tabella come vogliamo chiamare la tabella in cui spedirò questi dati name override è un tag che sta per dire come chiamerò la tabella su cui spedirò questi dati la tabella l'avevo chiamata monitor underscore task anche questo semplicemente possiamo scrivere quello che vogliamo se lasciamo tutti monitor underscore task vedremo tutti i dati concluire nella stessa tabella ok poi un ultimo tag che ho aggiunto è la possibilità di specificare ulteriori tag qui i tag sono potenzialmente illimitati vedete inputs punto exec punto tags e poi visto che stiamo lavorando con influxi b qua io ci posso mettere i tag che voglio ho scelto location valorizzato con urbino room localizzato con iot lab ma adesso potremmo mettere phone questa è l'aula no phone newman newman newman mettiamoci un underscore perché non sono momenti sono per spazio di piazza però abbiamo messo location urbino room phone newman possiamo mettere qualcos'altro possiamo aggiungere i tag che vogliamo tanto viene praticamente taggato l'informazione che noi spediamo io posso mettere desk cattedra come si dice in inglese ma non lo so mettiamo cattedra in italiano io sono sulla cattedra voi mettete il vostro banco non sono numerati i banchi vedo no avete un numero io metto cattedra cioè qui posso continuare con questa sintassi parola tag uguale valore tag quale valore tag quale valore posso continuare perché questa è la sintassi di input di B quindi ogni misura può essere taggata ogni field dentro perché la misura è la tabella il field è il valore numerico può essere taggato con le coppie chiave valore in qualche modo location uguale urbino room newman desk cattedra cosa per esempio com'è quindi così come cattedra didattica ma è va bene io sono la cattedra così va bene ci sta a questo punto non ci resta che fare salva che noi sappiamo bene che su nano è control 0 control 0 salva e a questo punto possiamo anche fare un control x così usciamo e abbiamo preparato il nostro file telegraph.conf adesso vogliamo fare un test allora telegraph come capite quando partirà farà un po' di cose no? perché la cosa che farà è lanciare un agente che dovrà connettersi a include B avete visto che nel plugin output c'è tutta la sintassi il server il token l'organization il bucket quindi prova la connessione instaurata la connessione lancerà il task lanciato il task lancerà un parser gork che cerca di cercare le informazioni che ci servono se le informazioni le trova crea la query per inviare sui includibili dati e li spedisce c'è tanta roba che farà telegraph quando partirà e ognuna di queste ognuno di questi step potrebbe non andare bene potrebbe andare male ognuno di questi step allora prima di lanciarlo to cure e mandarlo così alla deriva o meglio al tentativo facciamo un primo test per fare un test dobbiamo eseguire telegraph quindi scriviamo telegraph controllo ho detto contro il zero scusate ho detto contro il zero forse telegraph e la auto ah perché l'avevo creato su windows probabilmente l'avevo fatto piccola su windows telegraph meno meno test che questo serve a testare semplicemente il plugin quindi telegraph meno meno test meno meno config perché telegraph ha bisogno di un file di configurazione e poi gli diamo il nostro file di configurazione che è telegraph.com questa riga lancerà telegraph in modalità testing quindi se non ricordo male con questa modalità testing non invia le informazioni ma testa in locale vediamo cosa succede allora starting telegraph versione 1-2 inizializzati i plugin starting service di input store fix eccetera e vedete che lui la query che ha prodotto sarà questa monitor task è la misura virgola desk uguale chair host uguale raspberry pi 07 location uguale urbino room uguale von neumann e poi iniziano i field humidity 30.63 temperatura 33.64 e poi c'è il timestamp che è autogenerato da telegraph ok ecco se c'è stato invece qualche errore nel parser che non l'ha riconosciuto qui lo dovreste vedere da me è andato tutto a buon fine dopo c'è un numero lunghissimo dopo la temperatura è andato a capo quello è un timestamp spesso in millisecondi che è nel formato quindi il parser sembra funzionare qui vedete ha aggiunto monitor task che vi dicevo è quel name override lì che praticamente vi darà la misura cioè la tabella poi queste coppie chiave valore che abbiamo aggiunto noi come tag quindi desk chair host raspberry pi lo prende dal sistema operativo vi ricordate che all'inizio nell'agent c'era scritto appunto se lasciavi host vuoto l'andava a prendere il sistema operativo location urbino room on human humidity e temperature non ha inviato nulla in questa fase ha semplicemente fatto un test ok adesso invece vediamo se funziona davvero quindi togliamo test e mettiamo debug telegraph meno meno debug meno meno config e io dicendo proviamo a lanciarlo adesso prova anche a contattare il server vedete allora dice config inter da 30 secondi lost name è questo iniziato il plugin attempted connection to input db starting service e da me dice root batch quindi root vuol dire che è riuscito a scrivere ha scritto una metrica in 73 non millisecondi lui produce anche un buffer di metrica nel senso che se non riesce a scrivere scrive nel buffer locale e poi magari quando riuscirà a scrivere smoterà il buffer il buffer era definito sempre in agile quindi sì quello si può stringere vedete che l'ha scritto la prossima in 22 millisecondi adesso ci aspettiamo che se noi andassimo a navigare su il nostro server vedremo speriamo i nostri dati e questo lo possiamo fare lo vado a fare io potete farlo anche voi adesso faccio una nuova condivisione condivido questo vado su come che non mi ricordo mai l'indirizzo IP del server che non ho scritto ma voli sì mi sa che l'ho tolto malamente l'avevo ho tolto quella informazione ah in sostegno accesso qui c'è ok http qui per fare login è username se non sbaglio è studente e la password è un urb 01 20 21 me l'avevo salvata nel browser me la vado a cercare no no così lo fate anche voi aspettate sicuramente perché me l'ha mandata il buon Paolo Paolo confermi centrat direi di sì sì sì è quella bravo e andiamo a vedere fare un po' di esplorazione vediamo che facciamo explore data allora su esercitazioni che è il nostro bucket vi ricordate il nostro bucket è esercitazioni poi ci sono altri bucket qua che sono i bucket nostri di lavoro un urb 01 un urb IoT esercitazioni ci abbiamo come misura monitor task dentro la misura ci abbiamo vedete desk come campi host location room allora andiamo su room filtriamo per room ci abbiamo phone Newman qui qualcuno ha scritto Newman con la W nel mezzo nevman qualcuno ha scritto nevman aggiungiamo ci abbiamo ecco temp temperature desk io c'era il mio li possiamo scegliere tutti renoir lc siamo submit e vediamo i dati che cominciano ad arrivare vedete 32 33 31 25 ok vedete che continua a scrivere funziona anche da voi questa parte von nevman andiamo a vedere invece le umidità invece che le piuttosto che le temperature eccoci qua abbiamo anche un pc 8 che probabilmente è da qualcuno remoto noi siamo in 4 ah no siamo in 4 quindi siamo noi 4 pari le pc 8 renouir invece chi l'ha messo va bene vedete che sta funzionando sta continuando a inviare informazioni ogni esattamente 30 secondi e questo plugin telegraph funziona a prescindere mi dicevo da qualsiasi tipo di applicazione l'importante è che l'applicazione scriva dello standard output lui fa il parser dello standard output fa la sintassi che gli abbiamo spiegato e se lo trova spedisce il dato facciamo così quindi vi dicevo questi plugin telegraph sono molto comodi perché appunto noi potremmo avere un output prodotto da qualsiasi tipologia di applicazione la potremmo andare a parsare semplicemente con questo senza dover scrivere del codice perché basta configurare il nostro plugin poi i plugin di input sono innumerevoli adesso noi abbiamo usato il plugin input exec che prevede l'esecuzione di un comando ma ci sono plugin che interrogano le API del sistema operativo quindi potete semplicemente passare informazioni del tipo temperatura della CPU occupazione della CPU occupazione del disco traffico sulla rete tutte le informazioni che si possono estrarre dalle system call del sistema operativo potete inviarle grazie ad un input plugin che già esiste il file di configurazione che io ho messo su blended è un file di configurazione dove ho tolto tutti i plugin che non volevo usare altrimenti ci sono commentati innumerevoli esempi il file di configurazione che ottenete quando scaricate telegraph è grandissimo io l'ho pulito volutamente perché altrimenti ci avremmo messo dieci minuti solo a scorrerlo a trovare i plugin che servono a noi ma lo vedrete sicuramente che è grandissimo dopo si va e ve lo faccio vedere adesso direi di fare dieci minuti di pausa lasciamo però le nostre raspberry sparare le informazioni e dopo vediamo altri aspetti di come in realtà va eseguito telegraph perché noi adesso l'abbiamo eseguito da linea di comando con meno meno debug eccetera ma telegraph è stato installato come servizio quindi deve essere eseguito in background automaticamente come servizio e deve partire ogni volta che la macchina fa il boot così voi non ve ne preoccupate più minimamente adesso lasciamo l'eseguire così da linea di comando e poi ci vediamo fra dieci minuti devo mettere in pausa la registrazione vedrai quanto umidità hai buttato fuori sicuro io proprio vedo che all'inizio tutto secco così a fine allenamento tutti vedrai quanto umidità hai buttato fuori dopo l'allenamento sì sì là lo vedi sicuro poi se trovassi addirittura un sensore di CO2 andresti a capire anche quanto metaboliti hai prodotto perché la CO2 la producirà il tuo corpo non è che la produce altro ci sono sensori di CO2 noi ce li avevamo installati quando abbiamo fatto la cosa sono lavoroni di quadro C costano una quarantina d'euro però sono hanno una precisione assurda noi ci avevamo messo qui questa rete di misurazione di CO2 e normalmente la CO2 chi la produce o qualcosa che va a fuoco o una persona che respira un animale esatto quello dice io pensate che addirittura ci riusciva a vedere quando la bidella entrava la mattina alle sette e mezza perché tu vedevi la CO2 ferma tutta la notte alle sette e mezza cominciava a salire leggermente perché una persona era entrando qui sono solo la bidella che entrava alle sette e mezza poi dopo chiaramente quando arrivavano gli studenti la CO2 andava a manetta perché ognuno respira si riuscivi ad identificare una persona che entrava dalla CO2 che aumentava leggermente di scusa si se entra uno che respira che non è morto ci vuole un po' chiaramente non è che eh ma la CO2 la produce lo stesso la maschera si si la CO2 non è che la maschera non la blocca dovresti avere un filtro carboniattivi che ti blocca la CO2 no davanti sai quelle mascherone così quindi quando non credo che venga con allora torniamo a noi invece quindi ricondivido la mia raspberry perché adesso dobbiamo provare quindi facciamo un control c per terminare questa esecuzione che è un'esecuzione diciamo portata da linea di comando no perché abbiamo fatto telegraph meno meno debug meno config eccetera allora per eseguire telegraph nella maniera corretta bisogna eseguirlo come servizio ok ah output ma si vede che ha trovato un time out in conflitto con altre scritture dopo ecco lo tiene lo salva la prossima volta tanto il time stamp l'ha collezionato quindi dovrebbe andare bene anche sì quindi una volta che l'abbiamo stoppato andiamo a provare intanto facciamo un test di esecuzione che questa volta sarà un po' diverso perché allora quando installiamo il plugin telegraph in ambiente linux l'installatore cosa fa crea un account quindi un utente telegraph su linux che ha come potete immaginare pochissimi permessi così che questo possa eseguire in in background questo questo tool senza arrecare danni spesso e volentieri però questa cosa si male si si si matcha con applicazioni che lavorano con l'hardware come in questo caso la nostra applicazione sense che legge da sense app per vedere se eseguendolo questo comando come perché adesso noi l'abbiamo eseguito come utente pi l'utente pi è praticamente root proviamo ad eseguire telegraph come utente telegraph quindi potete fare un sudo meno un sudo meno un vuol dire fingo di essere l'utente e ora specifico il nome dell'utente l'utente si chiama telegraph sudo meno un telegraph e poi tutto il la linea di comando che c'era prima quindi sudo meno un telegraph vuol dire esegui come telegraph come account come utente telegraph il comando successivo che è telegraph meno meno debug eccetera eccetera perché quando lo eseguiremo come servizio verrà eseguito come utente telegraph che non è un utente privilegiato vediamo se potrebbe funzionare avete capito cosa sto facendo allora servizio è partito vediamo se sta funzionando starting service input ha funzionato ecco è messo andando errori ho detto permesso negato su un po' di cose non è riuscito se c'è un control c non è riuscito ad eseguire senza non è riuscito fare un mk di irli sopra insomma un po' di permessi negati vedete quindi se noi lo lanciassimo come servizio non partirebbe per questo motivo qua sì perché allora è riuscito a connettersi è riuscito a fare tutto ma non riusciva a lanciare cioè le onore vedete è nell'esecuzione di python3 desktop raspberry sensepy e ci sono un po' di problemi dice che la linea 17 settings file make the questa cosa qua non è riuscito a farlo questo perché per eseguire la libreria senseat probabilmente servono dei permessi in più allora la raspberry come funziona la raspberry ha definito diversi gruppi su cui inserire i vostri utenti questi gruppi hanno permesso ad esempio di accedere in libreria che contattano l'art proviamo a fare questa cosa allora l'avevo provato con lo shield autoprodotto e funzionava adesso non so se funzionerà anche con questo con questo sensat che non ho provato ma proviamo a fare quello che dobbiamo fare è aggiungere l'utente telegraph ai vari gruppi di accesso all'hardware quindi quello che sarà da fare sarà un sudo ad group groups dice qualcosa del genere Nicolò è proviamo a fare questa cosa quindi sudo ad group allora prima ci va l'utente sì che l'utente è telegraph e poi un gruppo ad esempio general purpose input output cpo ad group senza letto è stato aggiunto telegraph al gruppo general purpose input output secondo me dobbiamo aggiungerlo anche a i2c i4c e anche a fpi perché sensat usa un sacco di porte così abbiamo aggiunto vedete quello che ho fatto è aggiungere l'utente telegraph ha i vari gruppi di accesso all'hardware che sono i4c spi e general purpose input output vediamo se adesso funziona da ancora errore e mi sa che sta andando in time out l'exec vediamo buffer fullness zero però ancora l'exec secondo me non ha fatto ecco ancora permission denied su python3 ospy quindi ancora c'è qualcosa che non gli piace allora perché c'è la libreria sensat.py la linea 153 che cerca di fare che cosa cerca di fare os make this ma dove su make this si lanciando come pari avete visto funzionare se lo lanciamo con un cliente telegraph che vuoi aggiungere che vuoi aggiungere sul telegraph che è il nome dell'utente che vuoi aggiungere sul gruppo e poi il nome del gruppo come si fa la lista dei gruppi quindi cerca di sudo scrive sulla home ok e quindi ho fatto s». Ho fatto studio mi ho rubito mi sono ad squadre mi hai fatto tube mi hanno chances di mancare per esempio come dire Nicolò dice che sembrano i permessi di lettura sul conflitto. In realtà c'è quel dir che ci desta dei problemi. Vediamo un attimo. Su Google volevo vedere. Come si elencano i gruppi presenti? Allora lista gruppi. Non me lo ricordo. Non me lo ricordo. Ecco. Non me lo ricordo. possiamo provare ad aggiungere il gruppo pai che quello dell'utente però no si cerca di sì no però il gruppo pai tele che possiamo provare ad aggiungere tele che fa il gruppo pai che è il gruppo del utente pai non so se funzionerà mi sono spiegato ecco io così ho fatto ho aggiunto telegraph anche al gruppo pai vediamo se funziona però è strano perché debba andare a scrivere la sopra non funzionerà neanche così vero lei aggiunto al gruppo pai non ti fa questa parte qua di connessione per mission denise dc tele che top com però lui c'è questo problema di make dear vuole creare una directory dentro forse la plena di etc telegraph se fosse quello il problema potremmo dare diritti di scrittura su telegraph etc telegraph per creare un punto confine però non è quello sinceramente non è relativo a telegraph è relativo alla libreria senza arte perché dicevo se non usiamo la libreria senza arte usiamo l'altro shield funziona io perché le prove l'ho fatto con l'altro shield e mi bastava aggiungere al gruppo i quadro c e c'è nel parco di input out esatto si si mai sensato che da un problema si tenta di creare qualcosa no sinceramente vedete c'è questo file python 3 invoca o s python in boke mk dir alla linea 153 andiamo a vedere questo file dai mano non mi ricordo che linea era ok Grazie. Quindi, if OSPAT esiste, altrimenti fa make the U. Però eseguendo come telegraph... Ah, perché telegraph non ha la U. Direi, adesso ho detto tra noi, che questa libreria sensata potrebbe essere fatta anche un po' meglio. Adesso che si debba scrivere nella U dell'utente qualcosa, quando si lancia la libreria sensata la vedo. Sì. Però, scusa, scrivili nella directory della libreria di configurazione. E poi vai su ETC e sensata, non devo salvare, sulla home dell'utente. Ti evitavo che non ha funzionato. È una funzione con sensata. Vabbè, vi faccio vedere semplicemente i comandi quali erano, perché una volta che tu, insomma, avevi creato un file di configurazione, il tuo file di configurazione deve essere salvato in ETC Telegraph. Quindi avremmo dovuto fare un sudo IP, cioè copia il nostro Telegraph Conf, dentro ETC Telegraph, che è stata creata a lato di installazione, Telegraph.conf. Quindi il nostro file di configurazione che abbiamo prodotto deve essere caricato su ETC Telegraph.conf. Una volta che l'abbiamo copiato, ci vuole il sudo, chiaramente perché i diritti di scrittura non ce li abbiamo come Pai su ETC. Una volta che l'abbiamo copiato, dobbiamo lanciare il nostro Telegraph come servizio. Quindi sudo, sysctrl, anche io lo vado a vedere perché non mi viene provolata, systemctl, sudo systemctl reload, Telegraph.reload vuol dire carica il file di configurazione. Non ho scritto bene. Telegraph.service, scusate. Telegraph.service. Sì, domanda di nuovo. System CTL. Ho passato un pezzo. System CTL reload. Ok. Ah, prima devo fare enable, scusate, non reload. È meglio che copio, forse da qua. Sì, non ho fatto mai l'email. Devo fare, sì. Sì. Prima devo fare enable, però. Enable telegraph. Oh, ecco questo era. Quindi sudo system control enable telegraph, perché va praticamente a caricare il config. E poi system control start telegraph, così parte. Se vogliamo visualizzare cosa sta combinando, fate status. Sud, system control, status telegraph. E qui vi fa vedere errori, perché non riesce a scrivere. Vedete? Error. Dice che il servizio è attivo running, vedete, il servizio è attivo running, ma non riesce. Quindi, come vi dicevo prima, viene eseguito. Posso fare system control stop. Status, ora è spento. Restart. Telegraph. E poi con status andiamo a vedere. Partire parte il servizio, ma poi, come vedrete, a un certo punto andrà in out. L'errore, esatto. L'errore è esattamente quello che avevamo prima, vedete, permission denied. Non riesce a fare le make up a dire. Quindi il problema è che dovremmo risolvere, se volessimo usare Sensat con telegraph, è capire perché questa libreria Sensat voglia creare una make dear nella home path dell'utente. Oppure creare una directory all'utente telegraph. Forse creiamo una directory all'utente telegraph, probabilmente sotto home, allora dovrebbe anche riuscire a funzionare. Però, ecco, ripeto, secondo me la libreria poteva essere fatta un pochino meglio da questo punto di vista. Sì, dammi la possibilità di fare qualcosa, visto che sto salvando. Quindi facciamo stop e possiamo fare tranquillamente system disable. Perché altrimenti sono lasciati in enable. Ogni volta che fate il reboot della macchina il servizio riparza. Cioè, il concetto di servizio è proprio questo. Una volta che abbiamo installato un servizio, l'abbiamo abilitato, non ci curiamo più di questo. Perché quando la macchina viene riavviata, si è visto a parte di default. Quindi il vostro telegram partirà e continuerà a collezionare informazioni. L'idea è proprio quella, no? Usare un servizio, anziché lanciare da linea di comando questo programma, ha il vantaggio che la vostra macchina, se si riavvia ogni volta che riparte, comunque lancia il vostro plugin. Come? Tutti lanciati come servizi. L'alternativa potrebbe essere mettere l'esecuzione di Python, eccetera, Sense, nell'RTC, nella parte che lo lancia, però fare quindi un loop e via dicendo. Però la politica del plugin in Telegraph è proprio questa. cioè sicura lui di fare tutto. Quindi voi gli date il comando da eseguire, lui lo esegue con la sua frequenza, poi come vedete c'è il suo buffer, se qualcosa non va a buon fine, è un sistema molto solido che appunto ha meno di problemi di questo tipo, che non sono problemi legati a Telegraph, ma sono problemi legati alla libreria SenseHut, che magari non era previsto di essere eseguita in questa modalità, altrimenti funziona tranquillamente. Bene, io oggi la finirei qua, se avete qualche domanda sono ben contento, altrimenti cominciamo a smontare il tutto, e giovedì faremo di nuovo esercitazione, perché siamo un po' indietro con le esercitazioni. Forse è un po' colpo mio che mi sono un po' dilungato su questa cosa, ma sinceramente mi sembrava importante avere un po' di idee come lavorare con i flui di B, perché probabilmente questo progetto d'esame conterrà probabilmente un sistema basato su in 2DB. Vedremo anche altri sistemi server pronti a ricevere informazioni di altro tipo, quindi quando lavoreremo con il message passing vedremo che ci sono altri sistemi server in cloud che permettono di salvare e fare da broker di messaggi, però questa parte l'abbiamo esplorata abbastanza approfonditamente. Giovedì invece chiedo lo scambio dell'aula con Ferretti, perché altrimenti noi giovedì non possiamo fare un laboratorio, ma anche l'altra volta l'avevo fatto, visto che Ferretti inizia la lezione alle 10, basta fare lo scambio di un'ora, perché noi iniziamo alle 9, il laboratorio alle 9 sarebbe disponibile, chiedo a Ferretti che me lo dà anche nella prima ora delle 10, di solito non dà problemi, e quindi facciamo la prima presentazione questa volta invece con la piattaforma ESP, quindi il sensore è quello più piccolino e useremo la macchina virtuale che ho caricato su Moodle, che è la macchina virtuale Ubuntu, che ha già installato tutta la toolchain per compilare ed eseguire su ESP. La macchina virtuale in particolare la trovate già installata su questi computer qua, quindi semplicemente se venite qua dovremmo prendere l'ESP, un cavetto USB, collegarlo a questo computer, lanciare la macchina virtuale e faremo tutto. Se invece volete lavorare sul vostro portatile, caricatevi la macchina virtuale e installatela, la trovate su Blended. Ok? Ah, magari se c'è qualche problema dimmi perché io... Eh, perché io ho cercato di fare un file standard, no? Sì, eh, invece di caricare... Io l'ho fatto in VMware, però ho detto che è un file standard che quindi dovrebbe essere funzionale anche sugli altri. Va bene, quindi ci vediamo giovedì per l'esercitazione. questo è il file standard.