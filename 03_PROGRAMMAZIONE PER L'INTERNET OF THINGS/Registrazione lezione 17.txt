Allora, oggi facciamo un'altra esercitazione dove useremo sempre la piattaforma SP, però questa volta usiamo il protocollo MQTT per comunicare con un broker standard che è il broker messo a disposizione da uno scritto di Eclipse, quindi vedremo come utilizzare questi broker per scambiare messaggi dall'ASP verso un Vbroker oppure viceversa da un qualsiasi altro dispositivo verso l'ASP. Quindi anche oggi lavoriamo con la macchina virtuale e la piattaforma che useremo sarà Arduino. Se vado ad attivare anche la lavagna così... Il perm stato di comprensire questobeyto da un'altra esercitazione come upple stitchesi e di avere altri che usate senza fare questo ministro". Allora... Allora. No, Alcunu risiko conarla couldn'tare delle altre infrazioni delle altre states . Grazie. Grazie. Grazie. Utilizzata, come diceva, la piattaforma Arduino, che troviamo già installata. E andiamo a predisporre un progetto che essenzialmente farà la solita connessione Wi-Fi del dispositivo SP. Qui in aula attiverò, come al solito, un assist point. E, fatta la connessione, cercherà di scambiare dei messaggi col protocollo MQTT su un server di testing messo a disposizione aperto e gratuito, messo a disposizione dai clips che praticamente si è fatto gestore della piattaforma Moschitto, che si chiama. E praticamente implementa broker, publisher e subscriber di MQTT. MQTT. Allora, oggi non iniziamo a scrivere da zero, ma ho predisposto all'interno della piattaforma Blending questa mattina un progetto Arduino che andiamo a scaricare. E quindi useremo direttamente questo, lo commenteremo insieme e cercheremo di vedere appunto il suo funzionamento, senza però scrivere tutto il codice perché altrimenti sarebbe risultato abbastanza lungo. Allora, andiamo a logarci dalla macchina virtuale Blending. Gratee. Allora, eotsite! Allora, andiamo a quale ch entrada! se andiamo sulla parte iniziale del corso troviamo che ho aggiunto questa mattina esercitazione SP più MOSFIT MQTT più Arduino Sketch in questa directory c'è uno sketch di Arduino, quindi lo scarichiamo lo salviamo da qualche parte in locale e poi lo andiamo ad aprire io lo metto sulla home Arduino faccio una nuova directory in folder che chiamo MQTT non scritto ok, e qua dentro ci metto il mio sketch adesso lo possiamo aprire il nome deve essere esattamente identico ma lo crea lui ecco, e qua abbiamo il nostro sketch allora cosa faremo con questo sketch? useremo due modalità o meglio faremo sì che il nostro il nostro ESP si metta in ascolto per messaggi proveniente dal broker facendola sottoscrivendo quindi un sottoscrivendo quindi un listener e poi da un'altra piattaforma quello che andremo a fare è pubblicare messaggi su quel topic e quindi vedere se il nostro ESP effettivamente reagirà a questi messaggi ricordiamoci che il protocollo MQTT nasce proprio nel mondo IoT come scambi messaggi messaggi che possono contenere qualsiasi cosa possono essere string e poi possono essere convertiti in valori numerici quindi anche l'idea di inviare semplicemente una misura di temperatura una volta al minuto possiamo farlo tranquillamente anche con il protocollo MQTT anzi forse il protocollo MQTT nasce come vi ricordate proprio nella telemetria proprio per inviare valori numerici di questo tipo allora andiamo a vedere il nostro file che ho predisposto per una necessitazione allora quello che andiamo ad usare sono la libreria Arduino MQTT Client anche qua come potete immaginare su una piattaforma Arduino di librerie MQTT ne esistono un buon numero ne esistono un buon numero e Arduino MQTT è una diciamo delle più usate poi utilizziamo come vedete la libreria SP8266 Wi-Fi che è la solita per per poter accedere al Wi-Fi poi c'era l'inclusione di un file H che si chiamava set ma cancellatelo pure perché non lo usiamo in questa versione e quindi non c'è bisogno di fare quella inclusione dobbiamo anche utilizzare il LED nel senso che vogliamo andare a reagire magari a un messaggio proveniente da un publisher accendendo il LED allora il LED se non erro non è il D7 come avevo scritto qua in questa esercitazione che feci tempo fa ma devo andare a rivedere il LED come l'ha configurato il buon Paolo buongiorno vi ricordate qual era la porta del LED sì anche io lo sto cercando perché perché queste esercitazioni le avevo preparate quest'estate dopo Paolo ha rifatto tutta la piattaforma e dunque andiamo a vedere sicuramente quelle che ho caricato su cloud vanno sicuramente bene quindi se prendo la prima Arduino SP LED perché non mi sembra il D7 sinceramente no è il D0 infatti è il D0 si è trovato quindi quindi andiamo a modificare e là buongiorno andiamo a modificare il LED in D0 e poi ci siamo allora come dicevo dai vostri compagni oggi oggi facciamo un'esercitazione con Arduino il solito ESP dove andiamo a interagire con il protocollo MQTT su un server di test messo a disposizione da Eclipse dalla compagnia Eclipse Condition un server di test che gestisce il protocollo MQTT ok e questo server di test si chiama Mosquito quindi diciamo il tool MQTT si chiama proprio Mosquito adesso andiamo a vedere non iniziamo questa volta da zero con uno sketch vuoto ma come dicevo prima ho caricato su Blending questa mattina una nuova esercitazione dove c'è già uno sketch di Arduino così modificare il codice che è fatto bisogna fare qualche modifica perché come stavo dicendo queste esercitazioni le avevo provate queste state cioè le avevo predisposte queste state solo che dopo con il successo che Paolo ha rifatto queste scatoline e i pin non sono più gli stessi allora dobbiamo fare le modifiche dallo sketch che è scaricato da Blended perché effettivamente non funzionerebbe non è conforme quindi come dicevamo abbiamo importato Arduino MQTT client punto H è una delle tante librerie MQTT disponibili sulla piattaforma Arduino è una delle più usate insieme a quella che si chiama Adafruit MQTT quindi se ne sono come potete immaginare se sono diverse poi abbiamo importato la libreria wifi quindi S più 8266 wifi al solito perché come al solito questo sistema dovrà prima collegarsi ad access point per arrivare a rispetto bene nel nostro sketch abbiamo cambiato la definizione del led che era G7 ma in realtà nella nuova configurazione fatta da Paolo era un D0 il led è collegato sul D0 quindi abbiamo modificato il D7 da D0 abbiamo tolto l'inclusione di un file H che non ci serve che era Secrets che conteneva al suo interno l'SSID della rete wireless e la password ma li mettiamo direttamente qua quindi in SSID ci andiamo a mettere usiamo appunto l'access point che metto a disposizione io in quest'aula l'SSD l'altra volta che è esercitazioni con la E maiuscola e la password UniURB IoT esercitazioni e UniURB IoT ok la terza cosa che dobbiamo definire come vedete è un client ID allora il client ID è praticamente una sorta di username nel momento in cui vi collegate con la piattaforma Mosquito allora la piattaforma Mosquito Test è aperta quindi in realtà non dobbiamo fare sopra un account eccetera l'unica precauzione che vuole è che il client ID sia unico quindi non potete usare parole semplici perché magari qualcun altro sta usando la piattaforma Test in questo momento con un client ID IoT capite già che ci può dare gli errori allora io avevo fatto un mio client ID che era MySP UniURB pensando che nel mondo non ci fosse nessuno in quel momento ad usare un client ID UniURB che finisse con UniURB adesso siccome siamo da in quattro qui dentro differenziamoci comunque mettiamo MySP UniURB io metto zero e poi andiamo in modo tale da non andare in conflitto tra di noi in questa esercitazione perché questo client ID deve essere un invoco una piattaforma di test ripeto una piattaforma di test che non necessita neanche di fare l'account sopra e fare il login ecco che richiede il non utente semplicemente l'inno se userete un altro qualsiasi altro broker invece lì dovete fare il login ad esempio come abbiamo visto l'altra volta su ThinkSpeak anche lì abbiamo la possibilità di lavorare con il protocollo MQTT ma vi dovete fare un account quindi avreste il vostro client ID univo che proprio lo fornisce lei le chiavi eccetera quindi io qua ho scritto mysp1.urb0 e voi differenziatevi in conseguenza sì vedrà? ah allora forse perché è conforme a questo il file guarda un po' come inizia quindi è quello che ho caricato su cloud ma in realtà c'era già anche lì sì a meno dell'eliminazione di include secrets punto h sì allora è questo dai fai così guarda riuniforma questo non hai bisogno di riscaricarla dal cloud perché basta che uniformi quella perché praticamente è quella che io avevo preparato quest'estate siccome poi ho congelato la macchina virtuale è rimasta di solo quindi la trovate da non me lo ricordavo che c'era da comunque facciamo queste modifiche andando a mettere led di zero togliendo secret e andando invece a esplicitare ssid e password in maniera hardwire direttamente nel codice qui sopra quindi richiamo esercitazioni che poi univo biot il client id come vi ho detto cerchiamo di essere univoci ok adesso andiamo avanti pian piano lo commentiamo quindi seguite ma dovrebbe essere uguale allora il broker il broker è questo server di test infatti vedete è stato inizializzato con test come scritto punto org che è lo url che appunto vi offre il servizio di brokeraggio mqtt in maniera di testing gratuito sa le sue limitazioni eccetera fornisce diversi servizi anche criptati cifrati noi usiamo il più semplice quindi aperto tutti i messaggi saranno in chiaro sulla porta 1883 allora quando andiamo a fare una pubblicazione di un messaggio dobbiamo definire i topics come vi dicevo l'altra volta i messaggi sono taggati con quello che è un topics il topics è una stringa che può contenere proprio come un dominio dei sottodomini quindi vedete il topics dove noi pubblicheremo sarà il topic che si chiamerà come root iot slash message questo sarà il topic su cui noi come sp invieremo messaggi quindi lì saremo dei publisher in quel momento però ci metteremo anche in ascolto per un topic iot led quindi vuol dire che il nostro sp invierà messaggi sul topic iot message sarà lui a fare da publisher ma nel frattempo sarà anche subscriber per iot led quindi se qualcun altro nel mondo diventerà publisher iot led noi riceveremo quel messaggio perché vi dicevo il broker semplicemente smista i messaggi in base ai topic quindi se c'è qualcuno che pubblica con iot message saremo noi oppure scusate se pubblica con iot led noi lo riceveremo perché ci metteremo in ascolto su quel topic i topic sono delle stringhe come vedete dove abbiamo noi la libertà di formattarle con appunto il concetto di dominio sotto dominio poi ci serve un contatore questa variabile contatore conterà semplicemente il numero di messaggi che stiamo inviando e verrà incrementata ad ogni ciclo di invio messaggi quindi count inizializzato a zero chiaramente è una variabile globale poi cosa facciamo allora define led di zero l'abbiamo fatto pin mode allora mettiamo il pin output sulla definizione di led l'abbiamo chiamato di zero quindi mettiamo il led di zero in output perché chiaramente vogliamo accendere e spegnere il led nel momento in cui riceveremo un messaggio inizializziamo la comunicazione seriale con serial begin 115200 qua ecco quello che avevo trovato è che si consiglia una volta inizializzato il serial di attendere affinché il serial si inizializzi nella maniera corretta quindi facciamo un wide not serial .visa e poi proviamo a connettersi al wifi quindi a tempo di connettere wifi stampiamo l'SSID anche qui begin fin tanto che not connected stampiamo un puntino di led 5000 come abbiamo fatto l'altra volta se usciamo da questo ciclo io ho il connect e siamo a posto a questo punto invece inizia tutto il codice necessario per usare il protocollo MQTT una volta che abbiamo l'interfaccia wifi app andiamo subito a vedere come attivare il protocollo le librerie MQTT allora dobbiamo settare l'ID questa stringa che era definita in cima che era l'ID univoco nel nostro client e poi proviamo a connetterci al broker il broker è questo server test moschitto punto org quindi proviamo a fare la connessione con l'invocazione di connect su broker e la porta definita e se la connessione non va a buon fine vedete dichiariamo failed e poi se questa cosa strana in questo esempio while 1 perché si blocca lì se non si può connettere non sarà in grado di eseguire e fare il problema rimane fermo lì e lo riaviamo però è un errore capito nel momento in cui questo questo SP cosa deve inviare e ricevere messaggi se non riesce a collegarsi al broker la sua vita è inutile ok il while 1 spesso e volentieri si usa perché piattaforme microcontrollore hanno un sistema che si chiama watchdog cane da guardia non so se l'avete mai sentito nominare il watchdog scusate il watchdog praticamente in tutti i dispositivi al microcontrollore è un timer che se tu non lo azzeri periodicamente riavvia la CPU facendo while 1 tu interrompi la possibilità di di resettare il watchdog e quindi il watchdog dopo un minuto riavvia la piattaforma praticamente è una cosa particolare di microcontrollore quando tu programmi un microcontrollore e attivi un watchdog periodicamente ti devi ricordare di fare watchdog reset watchdog reset se non gli arriva il reset questo timer riavvia la CPU qualunque cosa la CPU stia facendo ah si si ti stroga assolutamente però capisci non sta funzionando quindi in realtà così dovremmo attivare il watchdog quindi dopo un minuto di while 1 pam riavvia e ritenta tutto ritenta la connessione e riparga non lo dovremmo fare noi manualmente ma i watchdog siccome sono hardware sono utilissimi per i microcontrollori perché quando voi avete un microcontrollore che va in panne remoto cosa ci fai? o vai lì stacchi la corrente invece il watchdog se tu sei in panne non riesci a fare reset periodico sul watchdog allora lui si riparte qualsiasi errore perché se tu non hai la possibilità di fare reset periodicamente lui riavvia e lui ha bisogno di essere riavviato è uno strumento di riavvia automatico per poter risentare perché lui fa il reboot e riparto era un po' come i dispositivi che avevano messo qualche anno fa mi raccontava uno che lavorava nelle ferivie dello Stato qualche anno fa mi dico anche una ventina di anni fa sulle locomotive perché le locomotive dovevano avere sempre due piloti perché se uno si sentiva male l'altro poteva interagire allora avevano tentato di fare un meccanismo che si chiamava uomo morto il pilota periodicamente doveva schiacciare una leva se non schiacciava la leva entro tot la macchina si fermava cominciava attivare i freni e si diceva vedi se è morto il pilota o è svenuto la macchina continua ad andare ogni freno continua ad andare solo che l'hanno tolta perché queste persone gli venivano un braccio così perché dovevano schiacciare questa leva praticamente una volta al minuto o anche meno ogni volta ogni 20-30 secondi capite una vita così una giornata così per motivi di salute avevano forza hanno ristabilito che i macchinisti devono essere due quindi invece di avere un solo macchinista quando il pulsante è periodo è un po' come il revente se non arriva la pressione della leva prima si ferma bene se tutto va a buon fine quindi se non ci incartiamo su questo ciclo vuol dire che ci siamo connessi e quindi stampiamo IAR Connect to MQTT Broker e poi facciamo una stampa bene per poter reagire a un messaggio in arrivo dobbiamo registrare una funzione di callback la funzione di callback la registriamo con MQTT Client On Message passandogli un puntatore a funzione On MQTT Message sarà definita sotto quindi abbiamo registrato il callback su il topic di subscribing poi andiamo a dire adesso ci sottoscriviamo al topic che abbiamo inizializzato sopra invocando subscribe su MQTT Client List and Topic quindi praticamente quello che succede è che il nostro Arduino si registra come vedete su il topic specificato in cima con la funzione On MQTT Message pronta per reagire scusate pronta per reagire al messaggio quando arriverà andiamo a vedere subito la funzione prima di vedere il loop è definita in phone vedete On MQTT Message è la callback che servirà a reagire che verrà invocata da Arduino quando un messaggio su quel topic verrà recapitato con il protocollo MQTT e qui andiamo a fare semplicemente un po' di stampa andiamo a dire vedete allora intanto ti riceve un parametro intero che è la dimensione del messaggio facciamo un po' di stampa e diciamo ricevuto il messaggio con questo topic message topic su message client che fornisce il topic di ricezione quanto è lungo message size e poi una volta che sappiamo quanto è lungo andiamo a leggere byte alla volta nel ciclo sotto questi byte arrivati nel messaggio trasformandoli in caratteri per avere una stringa ok quindi li leggeremo come stringa in MSG alla fine del ciclo ci sarà una stringa costituita da tutti i caratteri dei byte del payload del messaggio è chiaro questo ciclo? poi lo trasformiamo in oggetto string e a questo punto l'oggetto string andiamo a vedere se c'è scritto on vedete if message string è uguale a on allora digital write alto il pin led quindi accendo il led se c'è scritto off spengo il led quindi ecco qui vedete l'attuazione se qualcuno mi manda un messaggio sul broker con quel topic ci sarà scritto se dentro il messaggio il contenuto è on io accendo il led se il contenuto è off io spengo il led questa è l'idea e poi faccio semplicemente dico messaggio ricevuto e stampo anche l'intero messaggio così provvediamo a livello di debattu qual è il contenuto di questo messaggio bene a questo punto questa è la callback come vi dicevo che reagisce all'arrivo di un messaggio sul topic per il quale noi ci siamo attivati facendo la subscribe cioè sottoscrivendoci a questo topic andiamo a vedere invece che cosa fa il loop perché la callback è asincrona lavora con un inter praticamente quando arriva un messaggio MQTT arriva un inter viene eseguita la callback e la callback stamperà queste informazioni ma cosa fa il nostro SP nel loop ricordiamo che Carabinino ha sempre un core loop la funzione viene invocata periodicamente bene nel loop agiamo come publisher cioè inviamo i messaggi al broker per farli ricevere da qualcun altro allora nel loop dobbiamo sincerarci che il protocollo MQTT sia attivo quindi che la la piattaforma sia attiva MQTT lavora con il P sotto e quindi bisogna periodicamente vedete invocare la funzione poll su MQTT client questo semplicemente mantiene attiva la software connessione fatto questo ci prepariamo noi a essere publisher quindi ad inviare un messaggio con il topic che abbiamo definito in cima abbiamo definito due stringhe topic e list and topic topic è quello che noi invieremo messaggio su cui noi invieremo invece list and topic ci siamo registrati per ricevere messaggi topic era semplicemente IoT message quindi qui stiamo dicendo manderò un messaggio sul topic IoT message e stampo anche il valore di count che era zero perché ad ogni ciclo di loop count era incrementato di una andiamo a vedere cosa facciamo begin message con topic poi MQTT print tutte le print ci sono il payload quindi praticamente andiamo dopo che abbiamo detto begin la MQTT client si aspetta tutto il contenuto del messaggio che è sotto forma di stringhe quindi cosa andiamo a dire andiamo a stampare lo andiamo a stampare count che è questo valore numerico e poi invochiamo end message ecco che il messaggio è chiuso quindi vedete la libreria è abbastanza intuitiva perché c'è begin message tanto tanto tanto e poi end message a quel punto il messaggio è chiuso e viene inviato facciamo una stampa incrementiamo count e aspettiamo 5.000 millisecondi quindi questa applicazione che vedremo adesso all'opera che funziona è un'applicazione che fa esattamente due cose nel loop ci comporta da publisher verso il broker MQTT però ha anche registrato un subscriber per un topic e ha attivato una callback conseguente per reagire a questo topic bene adesso possiamo provare se abbiamo fatto cavolate a fare verify compile io intanto attivo access point qui così riusciamo a collegarmi perché l'altra volta si ha messo la password unilbyot adesso la faccio rivedere ho messo ssid esercitazione con la e maiuscola mentre la password unilbyot adesso lo attivo quindi devo ricordarmi di attivarlo esattamente in questo modo perché l'assess point non l'avevo ancora attivato altrimenti si spegneva spot mobile attivato le impostazioni cosa è un po' esagerato esatto esercitazioni esercitazioni va bene un minibus ai un minibus aiutti ok ce l'abbiamo allora io la sto ricontrollando è esercitazioni unilbyot esercitazioni con la e maiuscola adesso vediamo se la cosa può funzionare allora colleghiamo il nostro attrezzo e lo flasciamo io ho attaccato il compito di attenzione quello è una buona idea usare i guanti poi prima di toccare quelli lì bisogna anche mettere le mani nei mettete una mano su un po' l'afficore così si è dedicata all'energia statica anche quella aiuta guanti non guanti lì c'è poco da fare è in meno sono le valvole si ha due core quello quindi puoi fare anche questa volta la connessione wifi è andata subito ce ne ho già tre connessi ce ne ho tre connessi se aprite il serial monitor vedete 2mqtt connection failed attenti di connessi puntino puntino però mi fa fail sulla connessione mqtt a voi vi da un fail sulla connessione mqtt sì ma anche la connessione su mosquitto.org funziona perché a me invece mi si blocca lì e dopo vedi sempre col seriale vedi da me come fa io l'ho pubblicato lì attento lui dice attenti di connessi mqtt broker test mosquitto.org sì ok adesso ce l'ha fatta we are connected to the mqtt broker subscribing per top adesso iniziamo a mandare le salve prima iniziamo a mandare il problema di connessione mqtt perfetto andava in while while 1 e poi cadeva adesso vi faccio vedere noi stiamo pubblicando sul broker ma per poter vedere quei messaggi serve un subscriber se ci vuole qualcuno che si sottoscriva per il messaggio e i tmess su quel broker e li riceva al momento no non possiamo vedere niente no no no non ci faccio il sito di uno scritto perché il broker diciamo così è un servizio non grafico bisogna bisogna fare una subscribing per quel topic ci vuole o un altro sp che faccia il contrario invece di fare publisher di un messaggio faccia subscribe per quel messaggio e pubblico per l'altro ad esempio oppure qualsiasi altra macchina che possa vedere mqtt client che è un software che si scarica gratuitamente da un scritto allora siccome è una macchina virtuale già installato quella che andiamo a fare per vedere se questi messaggi arrivano è semplicemente andare ad aprire un terminale su una macchina virtuale Linux come potete immaginare mqtt client e broker per Linux esisteranno e sono gratuiti quindi una volta che abbiamo un terminale aperto intanto verifichiamo che esista davvero mqtt publisher mqtt subscriber quindi scriviamo mqtt sub vedete lo scritto sub esiste lo inviamo lo usiamo devi specificare un topic per sottoscriverti a quel topic quindi noi sappiamo qual è il topic e la sintassi per sottoscriveri è meno h dove h identifica l'host broker quindi adesso ci dobbiamo sottoscrivere chiamando l'host e l'host è test punto moschitto punto org quindi così stiamo chiedendo di sottoscriverci su il broker test punto moschitto org meno p che è la porta la porta che abbiamo scelto era la 1883 che era praticamente il protocollo mqtt più semplice spazio meno t la stringa che contiene il topic il topic lo essendo una stringa tra virgolette e se non sbaglio era io t esatto no perché quello è solo per essere publisher così che chi invia il dato lo firmi ma io voglio sottoscrivermi per un servizio aiuti message andiamo a vedere se funziona invio dovrebbe arrivare i messaggi se non si se non abbiamo sbagliato la sintassi aiuti message l'abbiamo scritto bene io non vedo arrivare nulla ecco arriva arriva e vedete che stanno arrivando a caso 67 37 44 perché perché tutti noi pubblichiamo sul topic aiuti message li leggiamo a tutti perché indipendentemente dalla sorgente tutti ha specificato come topic aiuti message siamo in quattro quindi lì ci sono messaggi mescolati di quattro publisher che stanno arrivando infatti non sono in ordine numerico crescente no esatto noi lo riceviamo perché l'unico filtro che chiediamo di trucca è iuti iuti iuti slash message quindi se qualcuno fa publisher iuti slash message noi lo riceviamo infatti vedete che stiamo ricevendo di tutto sì esatto solo che ecco io vedo che qualcuno è più avanti perché sta pubblicando il 77 qualcuno invece sta pubblicando il 55 qualcuno il 48 quindi pensate se il messaggio contenesse un valore di temperatura proveniente da n sensori evitando spazio sul territorio noi li potremmo integrare tutti e li raccogliamo quindi è abbastanza semplice da questo punto di vista allora il broker non è un server che salva informazioni ricordiamoci quindi ci vuole un subscriber come in questo caso che li legge e magari li invia sui QDB quindi l'idea è quella tanti client tante foglie SP fanno publishing sul broker istanziate un subscriber su quel broker che riceve tutto e invia magari in QDB nella tabella in questo modo avete la possibilità di integrare informazioni che provengono da tutti da tutti le sorgenti che avete istanziato avrete anche notato che l'arrivo dei pacchetti ha delle tempistiche strane in questo caso non arrivava niente poi sono arrivati a gruppi perché abbiamo scelto il broker IoT quello che ci dà il quality of service zero cioè la best effort nel senso io invio e buonanotte poi potete scegliere anche sulla piattaforma di testing mosquito potete scegliere i livelli di quality of service cambiando la porta loro sulla porta 1883 danno il servizio quality of service zero se cambi la porta ci ti dà tante altre possibilità di testare i servizi quindi essendo best effort il pacchetto se ti arriva ti arriva se non ti arriva non ti arriva non solo il broker questi pacchetti li accoda li basferizza e quindi in realtà i pacchetti ti possono arrivare più tardi di quando sono stati recepiti quindi se uno volesse davvero fare un sistema intelligente nel messaggio quantomeno un timestamp lo dovrebbe mettere perché ti potrebbe arrivare un pacchetto anche con un ritardo di 20 secondi 10 secondi oppure alcuni pacchetti non ti arrivano proprio quindi avendo il timestamp tu li potrai poi riordinare il titolo dei modi ma capite questa è la struttura più semplice della IoT per spedire informazioni con un protocollo molto leggero perché MQT è molto leggero non ha tutto diciamo così l'interfaccia HTTP sotto quindi è davvero molto più semplice rispetto a quello che abbiamo fatto inviando dati di influx di B perché lì lavoravamo col protocollo HTTP anche l'attività HTTPS insomma c'era un header del pacchetto molto più grande quindi sparmiamo tante anche tanto e tante energie nell'indiali HTTPS sono veramente piccoli diciamo noi decidere cosa metterci dentro l'abbiamo visto un'altra volta il leader è davvero snello bene ma se adesso volessimo accendere sto leg come facciamo? certo un publisher che pubblichi invece un messaggio di accensione ok e come facciamo? apriamo un altro terminale ancora di Linux quindi il primo terminale che rimane lì in ascolto è in subscribing aiuti messaggi andiamo invece in l'altro terminale e qui facciamo publishing noi a mano di un messaggio di accensione dell'et quindi moschitto questa volta pub non sub perché pub è per pubblicare quindi moschitto publisher meno host l'host è sempre il nostro broker che si chiama test punto moschitto punto org la porta è sempre 1883 il topic questa volta è iot slash led perché dobbiamo pubblicare su iot slash led quindi iot slash led e poi meno m message meno m ora ti do il messaggio sotto forma di stringa allora il messaggio ricordiamoci che noi ci aspettavamo un on e un off per decidere se accendere il led quindi facciamo on on era minuscolo se non sbaglio e facciamo invio ricordiamoci sempre il best effort quindi può arrivare con un po' di ritardo ammesso che arrivi ma se si viene recepito lo vediamo perché la callback esatto adesso è arrivato vedete si è chiuso 2sp è terminato ah sì sì scusa l'invio del messaggio è un istante quindi lo mando e poi basta no no lo mando e poi basta però vedete io l'ho ricevuto perché ho infatti acceso il led non l'hai ricevuto però ricordiamoci che è un best effort quindi prova a rimandarlo di nuovo allora guardate doveste avere la riga sì qualcuno ha mandato off adesso mi si è spento il led il canale è sempre lo stesso quindi tu puoi spegnere tutti i nostri dispositivi chiunque di noi può spegnere i dispositivi ah ok il led deve essere di zero non di set e vedete che adesso io li riaccendo tutti ecco l'ho acceso tutto scusami sì sì perché la piattaforma di test moschitto vuole che ogni client sia un invoco per scrivere per fare il publisher altrimenti andrebbe in conflitto solo per quello ma è solo una diciamo una caratteristica della test moschitto cioè per fare il test se invece tu lavori con la piattaforma reale devi avere un utente pastor chiaramente per fare il broker cioè per contattare il broker quindi per contattare il broker devi avere dei certificati anche poi lavorare con la criptografia vi dicevo qui i messaggi sono tutti in chiaro solo che questa piattaforma di testing vuole che i client abbiano un ID unico per esempio ma solo per fare publishing come vedete se voi aveste a casa non so se avete io ad esempio io ci sono off a casa tutti i miei interruttori dentro casa sono tutti IoT sono tutti interruttori che lavorano con il protocollo MQTT il broker MQTT che è distanziato da questa piattaforma che invece hanno il loro il broker personale o dell'Ivlink mi sembra qualcosa del genere interagisce con Google Home quando io dico Google Home hey Google spegne tutte le luci praticamente lui manda un messaggio MQTT a tutti gli registrati per il mio topic e gli dice shutdown tutte le luci chiudi apri tutti i relais è figo perché quando esco di casa Google spegne tutte le luci bobo spegne tutto quello che vuoi quindi pensate tutti questi interruttori dinamici IoT della Sonoff lavorano tutti come MQTT perché è molto semplice mandare un messaggio tant'è che una volta anche se la vostra app dello smartphone potete spegnere le luci a casa non ci vedete dire stessa cosa per i termostati onesti questi termostati qua se lo voglio accendere spegnere da telefono lui riceve un messaggio e mette il T chiaramente la quality of service non è la zero perché potresti spegnere la caldaia e magari il messaggio non lo riceve quindi usando la quality of service due o tre però il messaggio rimane molto leggero esatto altrimenti esatto lì il broker è interno alla piattaforma Sonoff quindi al loro sito non è che gestiscono un broker esterno per poter fare publishing lì sopra devi entrare con le tue credenziali vedete quanto è semplice adesso perché semplicemente noi questo lo potremmo mettere in casa siamo qui all'inusficio con la macchina Linux semplicemente scriviamo questa riga e si spegnere lì in casa quindi l'attuazione con Passage Pass MQTT è molto semplice poi abbiamo chiesto un led chiaro che lì ci potete collegare con le tue led nel bin di zero ci potete mettere un relè e lì ci mettete alla stupo pelle per via esatto andiamo a fare una pausa intanto questi continuano a lavorare quindi nella vostra pensate anche al vostro progetto d'esame potete usare come vedete diversi nodi ESP che mandano in MQTT a un broker e a quel punto fate un altro nodo che fa da subscribing ma è in via in QDB è un bel lavoro se testate una cosa di questo tipo tu hai il problema degli accelerometri sempre che devi inviare informazioni molto gli accelerometri ti servono per sapere quante volte è alzato il bilanciere? si si si ah si si le vedi delle curve certo le curve le devi spasare una parte prima una parte d'altra però ti serve la curva perché ancora non hai l'idea dell'algoritmo di processing di questi dati e vederli come sono fatti no perché altrimenti l'altra alternativa è che l'algoritmo sia tu SP e poi SP mandi invece un messaggio più sintetico del tipo il destro è più alto del sinistro oppure è rotazione però devi avere esamezione dell'algoritmo infatti anche semplicemente come visualizzazione senza dover inviare senza dover inviare tutti i campioni questo volevo dire inviare tutti i campioni costa sia energeticamente che come banda che come protocollo quindi l'agricoltio è abbastanza complesso allora se tu riesci a fare un pre-processing nel modo SP semplicemente è come diceva lui anche con una soglia se vedi che un accelerometro è più alto dell'altro dici ok secondo me non va se ancora non hai bene idea secondo me sì sì ma all'inizio ti chiamo giù di la alternativa perché devi capire cosa sta succedendo e lì ci puoi mettere un mbtt tranquillissimo sono in rea? sì l'unico problema è che per presa non vediamo il programma di blog sempre a gramma quindi il progetto aiutti se compriamo quasi i commerciali che mettiamo insieme perde un po' sì sì certo allora esatto sì il problema è che la sua novità ha la possibilità di sparare messaggi mqtt quasi sulla sua piattaforma non è aperta quindi bisogna che tu usi o google oppure usi il loro sito la loro affa il suo smartphone però capito perde un po' di significato per un corso di programmazione IoT perché semplicemente sta assemblando degli strumenti è carino questo è il sistema che sta usando le nuove interfacce di accessione e spegnimento quello che faccio io a casa io sono DSO registrati tutti su Google abbiamo fatto abbiamo preso la ciabatta abbiamo aperto la ciabatta dentro la ciabatta abbiamo messo solo un ESP quindi così la stufa si va attaccata nella ciabatta la ciabatta nel muro e lì dentro ti permette di circuiti e poi la ciabatta si ma quando lavori con la 2020 un po' di attenzione ci vuole insomma perché una cosa è bruciare un ESP una cosa è bruciare la scheda della stufa legge della stufa bella costo economico si si si si si la temperatura umiditaria lo puoi parlare tranquillamente con l'OCT domande a un broker considerate che nella Raspberry Pi esiste il broker di tempo scritto per la Raspberry Pi quindi la Raspberry Pi diventa un broker se installate il mosquito broker sulla Raspberry Pi quindi la vostra Raspberry Pi è il vostro server broker l'ESP manda un messaggio nel Google la vostra Raspberry di noi tra i subscriber e la Raspberry può installare anche un mosquito subscriber quindi un altro processo dentro la Raspberry riceve dal broker tutto e salva il locale oppure gli manda su tutti i piccoli o quello che vuole che la Raspberry può lavorare sia da broker che da client e quindi può installare sia da broker che qua anche in questa macchina virtuale di Inksu che sta installato in MQTT broker ma anche MQTT client adesso abbiamo utilizzato i client oggi lo subscriber e publishing ma c'è anche l'MQTT broker che sta installato si e va benissimo sì, quella è un'opzione che abbiamo da sperimentare sicuramente usare l'ESP, il protocollo HTTP, cifrato, eccetera che scrive sui inquadini, come dire c'è un cannone per ammastare una farfalla dal punto di vista energetico, prestazionale però è vero che si fa, nel senso chiaro che se vuoi invece siamo in un corso di programmazione IoT vuoi fare una cosa un pochino più raffinata un pochino più intelligente, con un occhio magari anche al consumo energetico, al traffico di dati generato allora passare su MTT è sicuramente la cosa migliore perché come dicevo i messaggi sono leggeri consumano poca energia è più un protocollo dedicato al mondo low power mentre le esercitazioni in HTTPS dove abbiamo con tutta la stack HTTPS sono un cannone per sparare assolutamente a me piace molto l'idea di avere una Raspberry Pi che fa da broker tutti gli ESP inviano in MTT per la Raspberry Pi istante in processo che fa da subscriber magari con quei dati ci fa quello che vuole quello che vuole può dire magari salvarli in maniera ordinata con 300 server MySQL sopra o installare anche il FUDP gira di sopra c'è una versione di FUDP leggera che gira anche sulla Raspberry cioè senza andare addirittura la Raspberry diventa anche il vostro collaboro oppure spegni il FUDP Cloud mi piace questa idea perché è un po' lo spirito della IoT cioè una macchina un pochino più potente che aggrega i dati che in questo caso è la Raspberry Pi esatto sì, perfetto sì sì quello è l'ideale che si è contente sì ma già se ci vanno a rafferci qualcosa esatto l'idea sarebbe dunque c'è così un bel progetto secondo me è nello spirito dell'Ot lo power lo data rate eccetera tu c'è il problema degli acceleroni ti tiene i MQTT e ti dicono devi mandare via cioè il payload del MQTT è limitato non è che ti puoi scrivere le 50 roba sopra adesso non ve lo ricordo ma ci facciamo una ricerca al volo su Google lo vediamo quindi perché in questa fase tu hai proprio bisogno di vedere le curve perché ancora non sai bene cosa aspettare facciamo 10 minuti di pausa dopo vi faccio un'idea invece un'altra piattaforma di brokeraggio che non è appunto Mosquito perché ha anche un'interfaccia grafica quindi tu dicevi prima dove li vediamo questi messaggi ecco Mosquito è un processo server senza interfaccia grafica leggero gratuito eccetera ci sono invece tantissime piattaforme una di queste è Thingspeak ma una delle più utilizzate è proprio la piattaforma da Fruit che sicuramente avete sentito che facendo un account gratuito di sopra si ha proprio una dashboard un cruscotto MQTT dove tu puoi fare un button col mouse premi il bottone e accendi le luci è una cosa è un'interfaccia web per il broker ma si mette su in poco tempo ecco il bello di questo ah si lo so però sapete queste cose abbiamo sempre detto mi sembra bisogna essere un po' smanettoni potestardi facciate le ripetere allora io adesso metto la pausa la registrazione metto in pausa la registrazione perfetto ctrl c e termini la shell no si quella roba sta allora quindi questo lo possiamo chiudere perché non usiamo più il broker o il subscriber locale chiudiamo un attimino anche lo sniffer della porta e adesso invece quello che andiamo a fare è prendere un browser e farci un account su adafruit input output chiaramente non siete obbligati a farlo se non volete fare io conosco gente che restia a creare account in giro su queste piattaforme io per questo per il lavoro che faccio io per il lavoro che faccio le devo fare in continuazione perché per fare dei test delle prove con questi strumenti quindi conorbidi eh ma tanto oh Mozilla ogni tanto cresce a visi ok riproviamo ok ok Ok, l'idea è di andare su una piattaforma che si chiama io.io.adafruit.com perché è la versione, diciamo così, per l'IoT imputato. Vedete, infatti la home page si dice subito The Internet of Things for Everyone. Anche qui c'è l'account free oppure piani di licenza più o meno costosi. Quindi lo URL è io.adafruit.com e qui vi chiederei, se volete, se no lavorate col mio, di fare un nuovo account. Get started for free. Allora, get started for free per name. Ci potete mettere anche cose facasulle. Le metto vere. Uso però un'altra mail che è l'attanti.manuele.com perché se uso quella di UniURB l'ho già fatto un account tempo fa, quindi at gmail.com Username, quindi io scelgo la tanti. Ah, esame di news, che è 76.03. Esame di tattico. Ok, quanti non fatti? E poi fate create. E l'account è stato creato. È molto semplice. Non so se deve essere addirittura attivato. Vediamo se è arrivata qualche mail. Non sembra di no. Per attivarlo. Ma da solo non siamo dentro. Quindi mi sa che è già attivo. Mi metto un messaggio se l'hanno inviato, ma no, neanche. Va bene. Comunque, quello che interessa a noi, questa è la piattaforma da fruit, dove potete acquistare anche hardware, eccetera. A noi interessa in cima, vedete dove ci sono i vari menu. Ah, io input output, quello piccolino là su, è quello che interessa a noi. Perché l'account che abbiamo appena creato è un account generico per la piattaforma da fruit, dove si compra anche. ecco. E vedete, il nostro account subito è stata generata in automatico dallo script, una dashboard di Welcome, Welcome Dashboard. Vedete, dicembre 2 l'ha creata adesso. Se ci clicchiamo sulla Welcome Dashboard, vediamo che cos'è. Allora, praticamente, il nostro cuscotto, dove è stato distanziato uno slider, vedete che va da zero, vedete, qua io posso interagire su questo slider, identificare un valore, sotto c'è un grafico che visualizza lo slider del U, quello lì non è interattivo, nel senso che è semplicemente un grafico, e poi sotto vi fa vedere un grafico dello storico, dei valori che avete dato al vostro slider. Vedete, man mano si è modificato, il grafico sotto si compone. Tipo? Esatto, vedete, questo qui è ciò che, è chiaro che adesso è tutto in locale, ma voi modificate lo slider, viene creato il grafico, e sotto c'è l'indicatore del valore dello slider. Chiaro che questo adesso ci dice poco a noi, ma a noi servirà interagire con questa tramite l'SP. Allora, questo vi fa vedere le potenzialità, nel senso che con l'SP potete inviare dati, un po' come lo fate sui fluidi B, e sotto vi viene fatto il grafico, perché se quel grafico lì, invece di legarlo allo slider locale, lo legate a un messaggio MQTT, è chiaro che di man mano a creare i valori, questi vengono visualizzati. Questo per farvi vedere che le potenzialità sono davvero tante. Ma noi, quello che interessa in realtà, è adesso ad esempio creare dei controlli, che poi invieranno messaggi di tipo MQTT al nostro ESP. quindi andiamo qua, dove c'è la casella impostazione, vedete che c'è qua sopra l'ingranaggino, e andiamo a dire edit layout, scusate, create un blog, e questi sono tutti i blocchi che io posso mettere nel mio dashboard, ce ne sono di vari tipi, ci sono i bottoni, ci sono i toggle, ci sono stringhe, ci sono grafici, fotografie, mappe, c'è una valanga di roba. prendiamo il primo, il toggle, che è lo switch praticamente, e mi dice dove lo vogliamo assegnare, lo mettiamo sul welcome feed, facciamo next step, e poi qui possiamo dare un titolo a questo bottone, possiamo chiamarlo luci, o led, chiamiamolo led, dai, tanto servirà per accendere il led sul nostro ESP, chiamiamolo led, il on text, off e off text, li lasciamo così, i colori anche, li lasciamo così, e lo pubblichiamo, adesso io con questo livello di zoom, non vedo il bottone, dove è, quanto meno, ecco, create block, il blocco l'ha creato, l'ha messo quasi in fondo, adesso lo vogliamo spostare, quindi per portarlo in cima, dobbiamo andare sull'ingranaggio, e fare edit layout, lo trasciniamo in cima, perché non mi piace averlo là giù in fondo, lo voglio vedere così in cima, save layout, e abbiamo il nostro bottone, adesso possiamo interagire col bottone, vedete, on off, cambia il colore, e abbiamo effettivamente fatto un controllo, ok, però adesso dobbiamo legarlo invece, alla nostra piattaforma, allora, adesso andiamo su, ops, my key, allora in alto, in cima, c'è services, se puoi my key, vedete, se clicchiamo su my key, ci dà le informazioni, legate al nostro account, vi dicevo, questo è un broker, dove ci si può accedere, solo avendo queste informazioni, non è un broker pubblico, quindi se abbiamo, io username, quello che avete scelto voi, io key, anche qui, è un token, bello complesso, che dopo dovremo copiare e incollare, nell'applicazione di Arduino, quindi teniamo il documento, come? Sì, vedete, c'è già, nello script di Arduino, di Linux, di Adafruit, scritti, no, di, già proprio fatti copi e incolla, e poi così, lo utilizzeremo insieme, ma l'altra cosa che dobbiamo fare, è per, torniamo in Edit Layout, perché dobbiamo, andare su Edit Block, come è che si faceva, scusate, no, io voglio cambiare, il nome, non è qui, voglio cambiare il nome di quel bottone, su Feeds, ah, Feeds, dovrebbe essere qua, Welcome Feed, va beh, qui ci sono tutte le modifiche che abbiamo fatto, sono tutti, praticamente, i messaggi che vengono generati, come si faceva a modificare, i Feeds, scusate, adesso, trigger, no, voglio cambiare il nome al bottone, per poterlo legare, in maniera, adesso lo trovo, piano piano, scusate, sì, no, non era quello, ci riprovo, eh, qui siamo sul nostro Welcome Dashboard, Dark Mode, Create Block, Edit Layout, Click, next step, next step, no, ci torna qua, scusami, no, no, dove erano quelli, adesso, cavolo, perché non lo trovo, scusate, adesso, l'ho fatto un po' di tempo fa, ma era molto intuitivo, quindi non me lo sono segnato, Edit Layout, no, perché, why? Sì, per avere la chiave identificativa di quel feed, cioè di quel, di quel bottone, Edit Feed, dove l'hai visto? Welcome Feed, oh, bravo, era questo, era questo, sì, sì, sì, ecco, vedete, chi è la Welcome Feed, io questo volevo modificare, Sì, scusate, torniamo un attimo, torniamo un attimo indietro, Feed Info, ecco, invece che Welcome Feed, io lo chiamerei, IoT Board, Board, IoT, adesso trattino, e c'è l'MQTT Key, vedete, che dopo cambia, perché l'abbiamo adesso aggiornato, questo serve per personalizzare le vostre chiavi, il Feed Info, la Key, il numero potete lasciare così, ma la Key è quella che si avverrà, vedete che sotto poi ci sono tutte le stringhe, vedete, per raggiungere con la chiave MQTT, avete la Tansi 7603, feeds, IoT Board, ok, la stessa cosa dobbiamo fare anche però, perché questo Welcome Feed vi mostra, praticamente, il valore dello slider, quando modifichiamo lo slider, dobbiamo associare questa cosa anche al button, quindi dovrebbe essere, su, feeds, new feed, ecco, andate su feeds, vedete, in cima, in alto c'è feeds, c'è new feed, il tasto per creare uno nuovo, vedete, facendo new feed, andiamo, come? creiamo un nuovo feed che sarà, IoT, trattino LED, lo creiamo, perché questo sarà il feed invece del bottone, ok, andiamo su feed info, vedete, la chiave è IoT LED, perché ne abbiamo due, adesso, nella nostra dashboard, abbiamo il nostro bottone LED, che però, dovremmo, associare al feed, vedete, torniamo sul nostro bottone, in modalità editing, andiamo su edit block, e ci dice, lo mettiamo sul feed IoT LED, così abbiamo associato, quello componente grafico, al feed IoT LED, facciamo un next step, adesso ci siamo, forse si potrebbe cadere da lì, bravo, era più corta la storia, ah, sì, esatto, mettiamo il nome, c'era create, scusate, però, ci siamo arrivati, piano piano, ci siamo arrivati comunque, adesso abbiamo due feed, uno, che si chiama IoT LED, che genererà, MQGT, messaggi, su, su quella, su quell'oggetto grafico, e l'altro, invece, che si chiama, non mi ricordo, andiamo a dire, welcome feed, ma la cui chiave, è più significativa, perché è la IoT, eccetera, che, rappresenta, il valore dello slider, e quindi, la nostra piattaforma, è pronta, quindi, togliamo appunto, il, mettiamoci nella condizione, di funzionare, adesso dobbiamo invece, lavorare, su il nostro, ESP, perché, con queste chiavi, eccetera, dobbiamo andarci, collegare, a questo feed, a questi due feed, scusate, allora, per fare questo, vi carico, questa volta, un file, che, non avete, sulla piattaforma Blended, così, l'andate, subito, a prelevare, allora, piattaforma Blended, sempre sull'ultima directory, vi vado a caricare, un file, che, sono già pronto, ah, però, no, devo, non devo farlo in Linux, perché ce l'ho qua, sì, ancora non c'è, però il file, no, non c'è, nella piattaforma, non c'è, perché l'ho fatto da poco, l'ho fatto, dopo averla congelata, quindi, no, no, non c'è, non c'è lì sopra, adesso ve lo carico, su Arduino, e se, me lo carico, su, su, Blended, vado a prendere questo file, che c'ho qui, in locale, trovo qua, il mio drive, programmazione, IoT, esercitazioni, Adafruit, MQTT, questo è, ok, adesso salvo, e voi dovreste vedere, Adafruit, MQTT, .ino, che è uno sketch, lo scarichiamo, lo salviamo, il locale, da qualche parte, e lo andiamo a aprire, con il nostro, Arduino sketch, l'avete trovato, l'avete trovato? Io non lo scopo scaricare, perché, ecco, l'ho trovato, no, mi scarico, no, mi scarico, di prima, Adafruit, dentro la directory, di prima, sì, sì, l'ho messo dentro quella di prima, non ne ho fatta una nuova, Adafruit, ecco, l'ho trovato, lo lanciamo, e l'unica, è già pronta, perché era un test che avevo fatto, qualche, un mesetto fa, mi sembra, l'unica cosa che dovremmo cambiare, e saranno le nostre password, le nostre chiave, e guardare se i feed li abbiamo nominati in modo diverso. Siete riusciti ad aprirlo? Io l'ho aperto, ah no, una cosa che dovete fare, probabilmente, sulla vostra piattaforma, è installare Adafruit MQTT, perché quando ho congelato la macchina virtuale non c'era, quindi, andiamo su Tools, dove che è, ecco, Manage Libraries, gestisce le librerie su Arduino, e cercate Adafruit underscore MQTT, sì, perché probabilmente da voi non c'è, Adafruit MQTT, ah, non c'è neanche qui, perché in realtà l'esercizio l'ho fatto dal computer d'ufficio, giusto? Sì, sì, è la prima, Adafruit MQTT Library, la trovate? E fate install, e non fate, fate anche installare le dipendenze, chiaramente, quindi lo devo fare anch'io, perché non mi ricordavo che l'esercizio non l'avevo fatto sul portante, ne mancava comunque, ok, e l'ha installata. Allora, per quanto riguarda, quindi, vedete, qui vengono utilizzate delle libri MQTT diverse, da che le abbiamo usate nell'esperimento precedente, sono le MQTT dedicate proprio ad Adafruit, e abbiamo al solito, la parola di chiave per accedere all'accesspoint, le cercetazioni, un'eutio, l'io server, che è io.adafruit.com, la porta, la 118.83, il protocollo MQTT standard, l'io username, adesso questi qui, e l'io key, li dobbiamo andare a copiare dal nostro account, siccome anche io ho modificato l'account, li vado a prendere, quindi il my key, copiate queste qua, per Arduino, ctrl C, e le mettete nel vostro Arduino Sketch. Fate attenzione che, quelle che vi propone le define, sono io username, ma qui nel nostro sketch abbiamo aio, per dire adafruit, quindi dobbiamo aggiungere una davanti. abbiamo valorizzato questi due define, adafruit a io username, adafruit a io key, con quelle che sono le nostre chiavi, questo ci permetterà di accedere al nostro MQTT server. Bene, poi cosa ci sono? Sono le variabili globali, il led di zero va bene, ecco, qua abbiamo invece il feed. Allora, i feed come si chiamano? Uno si chiamano, dobbiamo andare a vedere anche questi, quindi andiamo su feed, IoT, dobbiamo vedere le proprietà, quindi feed info, allora, uno è IoT led, IoT trattino led, l'abbiamo chiamato, quindi, feeds, IoT, IoT trattino led, e l'altro che, nell'esercizio che avevo fatto a tempo, si chiamava slider, in realtà, l'abbiamo chiamato, andiamo a vedere, feeds, welcome feeds, la sua info, è IoT board, quindi feeds, invece che slider, IoT board, avete capito dove ho fatto le modifiche? perché vedete, qui vado a fare la subscribe, vedete, due client subscribe, uno slider, e uno on off button, quindi in realtà, questa applicazione di Arduino, sarà solo subscriber, e si sottoscrive per due feeds, per l'IoT board, che è lo slider, quindi ci fa vedere il valore, strascinando il tastino, e per l'on off button, che invece è IoT led, vedete che qui di default, l'applicazione usa quality of service, uno, non zero, ad a fruit, di default usa uno, però anche qui è selezionabile, la quality of service, se mettete zero, è quello che funzioni con me, adesso andiamo a vedere, ci sono le funzioni, vedete la slider callback, la funzione slider callback, sarà quella che vi sarà invocata, quando riceverete, un MQTT message, su il topics, il board, e non fa nient'altro, se non dire, guarda che lo slider, il valore è stampa X, l'on off callback, invece, è quella di prima, se l'on off callback, dice, appunto, il messaggio, che sarà uno o zero, se è uno, metto il led alto, se è zero, se è diverso da uno, metto l'on. Allora, forse dobbiamo configurare però il bottone, il bottone dobbiamo configurarlo, per scrivere uno, mi sta piuttosto che on off, dopo ci guardiamo, se l'abbiamo fatto bene. Poi, il resto, è il solito, si attiva, la comunicazione seriale, si attiva il wifi, e poi si attivano le callback, vedete, set callback su slider, set callback su on off button, e poi facciamo la subscription, su slider, su on off button, e initalizziamo il pin, chiaramente. Il loop cosa fa? Il loop fa MQTT connect, e poi questa libreria di Adafruit, rimane bloccata su MQTT connect, e appena esce, invia MQTT process packet. E poi c'è anche qui il ping, per andare a valutare se la connessione è stabile, oppure bisogna rifare la connessione MQTT. La connect, vedete, rivaluta di nuovo il wifi, insomma è un sistema abbastanza robusto, perché se dovesse cadere il wifi, fra un messaggio e l'auto, si ritira su, e insomma sono tutti, diciamo, funzionalità. Andiamo a vedere se funziona, dai, facciamo un verify e upload, le modifiche che dobbiamo fare, alla fine non è annotate da questo codice, a parte le chiavi, e a parte i feeds, che li abbiamo chiamati in modo diverso, rispetto al file che avevo preparato, tempo fa. Ma sì, buttiamoli in compiling e upload diretto, quindi siamo fiduciosi. Oster, accessorment qui, Windows l'avrà spento, se è il montile. Forse è rimasto acceso, bravo. Ah, è acceso, acceso. Siamo con 4 dispositivi connessi. Allora, il verify è andato bene. Sta partendo l'uploading. e vedremo cosa succederà. Questa volta, i dispositivi, attraverso la piattaforma da fruit, dovreste riuscire a controllare solo il vostro, perché le chiavi sono diverse. Non si dovrebbe essere il problema di prima, che uno spegneva le luci. Ok, il mio reset l'ha fatto, andiamo a aprire il serial monitor, come al solito, per vedere se ci sono errori di qualche genere. Possiamo anche fare un reset ben autorale. Leonardo, il reset, così vediamo se stampa qualcosa. Il mio sta facendo un po' di puntini in questo istante. Ecco, wifi connect, connect to MQTT. Ah, il mio dice che è connesso anche MQTT. Adesso vado a vedere dall'interfaccia ad approved se riesco a mandare giù qualche feed. quindi vado sulla mia dashboard e a questo punto mi metto così e vado a modificare lo slider. Ah, lo slider è arrivato, il feed. Vedete, mi dice che il valore è 41. lo slider sta funzionando. Vedete che, pensate, no, lo slider, ad esempio, a un termostato dove settate la temperatura, vedete, gli arriva a 78 gradi, arrivano a 78 gradi al nostro dispositivo locale. vediamo se funziona il button. Ah, ecco, funziona ma dice on off ma non accende il led perché in realtà abbiamo configurato il bottone per inviare la stringa on e off. Dovremmo configurare, invece, nell'if che c'era nel codice ci aspettavo un 1 per accendere il bottone che invece dovrebbe cambiare la configurazione del gadget di button sulla piattaforma per inviare un off, un 1 e uno 0. Perché la callback funziona, vedete, ma non accende e spegne il led perché il controllo con l'if è 1 non value on. Di connessione? La chiave l'hai copiata bene? Sembra. Prima ti diceva connected? No, no, MQTT connected non te lo fa, quindi. Non l'SP? Ah, è una strana. potrebbe essere. Adesso io vado a modificare il nostro bottone perché il bottone, vedete, i valori, control- on value, ci metto 1, off value, ci metto 0, quindi così mi manda dei valori numerici invece che la stringa è un'altra. Save. Adesso il bottone, la luce si accende e si spegne. Vedete, anche con questo è facile fare un plus forte di mire molto. Quando l'ho trovato l'inizio di una configurazione di un'altra che è un'altra che è un'altra che è un'altra che è un'altra che è un'altra che è un'altra che è un'altra che è un'altra quindi vi fate il vostro cruscotto e da qui accendete e spegnete le vostre luci. cari. devi fare modifica qua nella dashboard in cima qua c'è edit poi cliccare su edit blog cosa vuoi modificare vai su next step sì sì sì perché quello che prende da lì compone lui e di uno zero così funziona quindi non gli piacevano a te la metteva due volte esatto bene abbiamo finito perché vedo già che ci sono studenti dell'ora dopo fuori l'aula occupata sì ricordiamo bene insieme molto potente io ho previsto già un sistema ok quindi interrompo la registrazione esatto funzionato benissimo da quali ti osservi abbiamo messo uno qui quindi genera un pochino più di pacchetti però ok ci vediamo martedì per la testificazione uno di merchanti Grazie.